<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Tapowan Public School - Login / Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<!-- Chart.js for reports -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
        /* Custom styles for the login page */
        :root {
            --primary: #3B30A3; /* Deeper Indigo */
            --primary-dark: #2C247A; /* Even Deeper Indigo */
            --secondary: #0D9488; /* Teal 600 */
            --accent: #D97706; /* Amber 700 */
            --dark: #1F2937; /* Gray 800 */
            --light: #F9FAFB; /* Gray 50 */
            --gray-light: #E5E7EB; /* Gray 200 */
            --gray-medium: #6B7280; /* Gray 500 */
            --gray-dark: #374151; /* Gray 700 */
            --border-color: #D1D5DB; /* Gray 300 for borders */
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --modal-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --primary: #6D5EDF; /* Lighter Indigo for dark mode */
            --primary-dark: #5A4DC2;
            --secondary: #2DD4BF; /* Lighter Teal */
            --accent: #FBBF24; /* Lighter Amber */
            --dark: #F9FAFB; /* Light text */
            --light: #1F2937; /* Dark background */
            --gray-light: #374151; /* Darker gray for borders/dividers */
            --gray-medium: #9CA3AF; /* Lighter gray for medium text */
            --gray-dark: #E5E7EB; /* Even lighter gray for dark text */
            --border-color: #4B5563; /* Darker border */
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --modal-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent body scroll when modals are open */
        }

        /* Adjust elements for dark mode */
        body.dark-mode .login-container,
        body.dark-mode .modal-content,
        body.dark-mode .sidebar,
        body.dark-mode header,
        body.dark-mode .module-card,
        body.dark-mode .notification-dropdown,
        body.dark-mode .view-all-content,
        body.dark-mode .user-dropdown,
        body.dark-mode .holiday-list-item,
        body.dark-mode .module-content input,
        body.dark-mode .module-content select,
        body.dark-mode .module-content textarea,
        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea {
            background-color: var(--light); /* Use dark background for these elements */
            color: var(--dark); /* Use light text color */
            border-color: var(--border-color);
        }

        body.dark-mode .login-header h1,
        body.dark-mode .modal-content h2,
        body.dark-mode .sidebar .logo-section h1,
        body.dark-mode header h2,
        body.dark-mode .notification-dropdown .header h4,
        body.dark-mode .view-all-header h3,
        body.dark-mode .module-card h3,
        body.dark-mode .module-card h4,
        body.dark-mode .module-content label,
        body.dark-mode .form-group label {
            color: var(--dark); /* Ensure headings and labels are light */
        }

        body.dark-mode .text-gray-600,
        body.dark-mode .text-gray-500,
        body.dark-mode .text-gray-400,
        body.dark-mode .sidebar .nav-section h3,
        body.dark-mode .sidebar .nav-item,
        body.dark-mode .sidebar .nav-item i,
        body.dark-mode .notification-item .time,
        body.dark-mode .view-all-notification .time,
        body.dark-mode .user-dropdown-item,
        body.dark-mode .user-dropdown-item i,
        body.dark-mode thead th,
        body.dark-mode tbody td {
            color: var(--gray-medium); /* Adjust text colors for readability */
        }

        body.dark-mode .sidebar .nav-item:hover,
        body.dark-mode .notification-item:hover,
        body.dark-mode .view-all-notification:hover,
        body.dark-mode tbody tr:hover {
            background-color: var(--gray-light); /* Darker hover background */
        }

        body.dark-mode .sidebar .nav-item.active {
            background-color: var(--gray-light); /* Darker active background */
            border-left-color: var(--primary);
            color: var(--primary);
        }
        body.dark-mode .sidebar .nav-item.active i {
            color: var(--primary);
        }

        body.dark-mode .tab {
            color: var(--gray-medium);
        }
        body.dark-mode .tab:hover {
            background-color: var(--gray-light);
            color: var(--dark);
        }
        body.dark-mode .tab.active {
            background-color: var(--gray-light);
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        /* Specific adjustments for icons/buttons */
        body.dark-mode .icon-wrapper {
            background-color: rgba(255,255,255,0.1); /* Slightly transparent white */
        }
        body.dark-mode .icon-wrapper.bg-blue-50 { background-color: rgba(59, 48, 163, 0.3); }
        body.dark-mode .icon-wrapper.bg-green-50 { background-color: rgba(13, 148, 136, 0.3); }
        body.dark-mode .icon-wrapper.bg-yellow-50 { background-color: rgba(217, 119, 6, 0.3); }
        body.dark-mode .icon-wrapper.bg-purple-50 { background-color: rgba(139, 92, 246, 0.3); }
        body.dark-mode .icon-wrapper.bg-red-50 { background-color: rgba(239, 68, 68, 0.3); }
        body.dark-mode .icon-wrapper.bg-indigo-50 { background-color: rgba(99, 102, 241, 0.3); }
        body.dark-mode .icon-wrapper.bg-orange-50 { background-color: rgba(249, 115, 22, 0.3); }
        body.dark-mode .icon-wrapper.bg-pink-50 { background-color: rgba(236, 72, 153, 0.3); }

        body.dark-mode .fc-day-today {
            background-color: var(--gray-light) !important;
        }
        body.dark-mode .fc-toolbar-title {
            color: var(--dark);
        }
        body.dark-mode .fc-daygrid-day-number {
            color: var(--gray-medium);
        }
        body.dark-mode .fc-button {
            background-color: var(--primary-dark) !important;
        }
        body.dark-mode .fc-button:hover {
            background-color: var(--primary) !important;
        }
        body.dark-mode .fc-button-active {
            background-color: var(--primary) !important;
        }


        /* Login UI Specific Styles */
        #login-ui {
            display: flex; /* Initially flex to center content */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            width: 100%;
        }

        .login-container {
            background-color: #ffffff;
            border-radius: 1.25rem; /* Slightly more rounded */
            box-shadow: var(--modal-shadow); /* More pronounced shadow */
            padding: 3rem; /* Increased padding */
            width: 100%;
            max-width: 480px; /* Slightly wider */
            text-align: center;
            animation: fadeIn 0.6s ease-out;
        }

        .login-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2.5rem; /* Increased margin */
        }

        .login-header img {
            width: 90px; /* Slightly larger */
            height: 90px;
            margin-bottom: 1.25rem;
            animation: popIn 0.5s ease-out;
        }

        .login-header h1 {
            font-size: 2.5rem; /* Larger font size */
            font-weight: 700;
            color: var(--primary-dark);
            animation: slideInFromTop 0.5s ease-out;
        }

        .role-selection {
            display: flex;
            justify-content: space-around;
            margin-bottom: 2rem; /* Increased margin */
            gap: 1.25rem; /* Increased gap */
        }

        .role-button {
            flex: 1;
            padding: 1rem 1.25rem; /* Increased padding */
            border-radius: 0.75rem; /* More rounded */
            border: 1px solid var(--border-color);
            background-color: var(--light);
            color: var(--gray-dark);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem; /* Increased gap */
        }

        .role-button i {
            font-size: 1.75rem; /* Larger icons */
            color: var(--gray-medium);
        }

        .role-button.active {
            border-color: var(--primary);
            background-color: var(--primary);
            color: white;
            box-shadow: 0 6px 15px rgba(59, 48, 163, 0.25); /* Stronger, primary-colored shadow */
        }

        .role-button.active i {
            color: white;
        }

        .role-button:hover:not(.active) {
            background-color: #F3F4F6; /* Lighter gray on hover */
            color: var(--primary-dark);
            border-color: var(--primary);
        }

        .role-button:hover:not(.active) i {
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 1.5rem; /* Increased margin */
            text-align: left;
        }

        .form-group label {
            display: block;
            font-size: 0.95rem; /* Slightly larger font */
            font-weight: 500;
            color: var(--gray-dark);
            margin-bottom: 0.6rem; /* Increased margin */
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.85rem 1.1rem; /* Increased padding */
            border: 1px solid var(--border-color);
            border-radius: 0.6rem; /* More rounded */
            font-size: 1.05rem; /* Slightly larger font */
            color: var(--dark);
            background-color: #ffffff; /* White background for inputs */
            transition: all 0.2s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 48, 163, 0.15); /* Softer, primary-colored focus ring */
        }

        .login-button {
            width: 100%;
            padding: 1rem 1.75rem; /* Increased padding */
            background-color: var(--primary);
            color: white;
            font-size: 1.15rem; /* Slightly larger font */
            font-weight: 600;
            border: none;
            border-radius: 0.75rem; /* More rounded */
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(59, 48, 163, 0.2);
        }

        .login-button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(59, 48, 163, 0.3);
        }

        .login-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(59, 48, 163, 0.2);
        }

        .forgot-password {
            margin-top: 1.5rem; /* Increased margin */
            font-size: 0.95rem; /* Slightly larger font */
        }

        .forgot-password a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .forgot-password a:hover {
            text-decoration: underline;
            color: var(--primary-dark);
        }

        /* Keyframe Animations (copied from School Site.html for consistency) */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInFromTop {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes popIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.65); /* Slightly darker overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #ffffff;
            padding: 3rem; /* Increased padding */
            border-radius: 1.25rem; /* More rounded */
            box-shadow: var(--modal-shadow); /* Stronger shadow */
            width: 100%;
            max-width: 450px; /* Slightly wider */
            text-align: center;
            transform: translateY(-30px); /* More pronounced slide-in */
            transition: transform 0.3s ease;
            position: relative; /* For close button positioning */
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-close-button {
            position: absolute;
            top: 1.25rem; /* Adjusted position */
            right: 1.25rem;
            background: none;
            border: none;
            font-size: 1.75rem; /* Larger icon */
            color: var(--gray-medium);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .modal-close-button:hover {
            color: var(--gray-dark);
        }

        .modal-content h2 {
            font-size: 2rem; /* Larger font size */
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 1.75rem; /* Increased margin */
        }

        .modal-content p {
            color: var(--gray-dark);
            margin-bottom: 1.75rem; /* Increased margin */
            line-height: 1.6; /* Improved readability */
        }

        .modal-content .form-group {
            margin-bottom: 1.75rem; /* Increased margin */
        }

        .modal-content .login-button {
            margin-top: 1.5rem; /* Increased margin */
        }

        /* School Site UI Specific Styles */
        #school-site-ui {
            display: none; /* Initially hidden */
            width: 100%;
            height: 100vh;
            overflow: hidden; /* Ensure no scrollbars on the main body */
            background-color: var(--light);
            color: var(--dark);
        }

        /* General transitions for smoother UI */
        .sidebar, .nav-item, .module-card, .notification-dropdown, .view-all-modal, .tab, .user-dropdown, .fc-button {
            transition: all 0.3s ease-in-out;
        }

        /* Custom Keyframe Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInFromLeft {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInFromTop {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes popIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Apply animations */
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
        }
        .animate-slideInFromLeft {
            animation: slideInFromLeft 0.4s ease-out forwards;
        }
        .animate-slideInFromTop {
            animation: slideInFromTop 0.4s ease-out forwards;
        }
        .animate-popIn {
            animation: popIn 0.3s ease-out forwards;
        }

        /* Sidebar Styling */
        .sidebar {
            background-color: #ffffff; /* White background */
            box-shadow: var(--card-shadow); /* Subtle shadow */
            padding-top: 1.5rem; /* Increased padding */
        }
        .sidebar .logo-section {
            padding: 0 1.5rem 1.5rem; /* Adjusted padding */
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 1.5rem;
        }
        .sidebar .logo-section img {
            width: 48px; /* Consistent size */
            height: 48px;
        }
        .sidebar .logo-section h1 {
            font-size: 1.35rem; /* Adjusted font size */
            color: var(--primary-dark);
        }
        .sidebar .nav-section h3 {
            font-size: 0.75rem; /* Smaller uppercase text */
            color: var(--gray-medium);
            margin-bottom: 0.75rem;
            padding: 0 1.5rem; /* Align with nav items */
        }
        .sidebar .nav-item {
            color: var(--gray-dark);
            padding: 0.85rem 1.5rem; /* Increased padding */
            border-radius: 0.75rem; /* More rounded corners */
            display: flex;
            align-items: center;
            gap: 1rem; /* Increased space */
            font-weight: 500;
            margin: 0.25rem 0.75rem; /* Add horizontal margin for rounded effect */
        }
        .sidebar .nav-item i {
            font-size: 1.15rem; /* Slightly larger icons */
            color: var(--gray-medium);
        }
        .sidebar .nav-item:hover {
            background-color: #F3F4F6; /* Light gray on hover */
            color: var(--primary-dark);
        }
        .sidebar .nav-item:hover i {
            color: var(--primary);
        }
        .sidebar .nav-item.active {
            background-color: #EEF2FF; /* Light indigo background */
            border-left: 4px solid var(--primary); /* Primary color border */
            color: var(--primary-dark);
            font-weight: 600;
            margin-left: 0; /* Remove left margin for active item to align border */
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        .sidebar .nav-item.active i {
            color: var(--primary);
        }

        /* Module Card Styling */
        .module-card {
            background-color: #ffffff;
            border-radius: 1rem; /* More rounded corners */
            box-shadow: var(--card-shadow); /* Subtle initial shadow */
            transition: all 0.2s ease-in-out;
            border: 1px solid transparent; /* For hover effect */
        }
        .module-card:hover {
            transform: translateY(-6px); /* More pronounced lift */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12); /* Stronger shadow on hover */
            border-color: var(--primary); /* Highlight border on hover */
        }
        .module-card .icon-wrapper {
            padding: 0.85rem; /* Increased padding */
            border-radius: 0.75rem; /* More rounded */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.35rem; /* Larger icons */
        }

        /* Top Bar Styling */
        header {
            background-color: #ffffff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 1.25rem 2rem; /* Increased padding */
            border-bottom: 1px solid var(--gray-light);
        }
        header h2 {
            font-size: 1.6rem; /* Larger title */
            font-weight: 600;
            color: var(--dark);
        }

        /* Notification Dropdown Styles */
        .notification-dropdown {
            position: absolute;
            top: 70px; /* Adjusted for better alignment */
            right: 25px;
            background-color: white;
            border-radius: 1rem; /* Consistent rounding */
            box-shadow: var(--modal-shadow); /* Stronger shadow */
            width: 350px; /* Slightly wider */
            max-height: 450px; /* Taller */
            overflow-y: auto;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px); /* More pronounced slide-down */
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            pointer-events: none;
            border: 1px solid var(--border-color);
        }
        .notification-dropdown.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        .notification-dropdown .header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-light);
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
        }
        .notification-item {
            padding: 14px 1.5rem; /* Increased padding */
            border-bottom: 1px solid #F3F4F6;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }
        .notification-item:last-child {
            border-bottom: none;
        }
        .notification-item.unread {
            background-color: #EEF2FF; /* Light indigo for unread */
        }
        .notification-item:hover {
            background-color: #F9FAFB;
        }
        .notification-item.unread:hover {
            background-color: #E0E7FF; /* Slightly darker indigo on hover */
        }
        .notification-item .title {
            font-weight: 600;
            color: var(--gray-dark);
            margin-bottom: 6px; /* Increased margin */
            font-size: 0.95rem;
        }
        .notification-item .time {
            font-size: 0.7rem; /* Slightly smaller */
            color: var(--gray-medium);
        }
        .notification-footer {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #F3F4F6;
        }
        .notification-footer button, .notification-footer a {
            color: var(--primary);
            font-weight: 500;
            font-size: 0.9rem;
        }
        .notification-footer button:hover, .notification-footer a:hover {
            text-decoration: underline;
            color: var(--primary-dark);
        }

        /* View All Notifications Modal Styles */
        .view-all-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7); /* Darker overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-out;
        }
        .view-all-modal.active {
            opacity: 1;
            pointer-events: auto;
        }
        .view-all-content {
            background: white;
            border-radius: 1.25rem; /* Even more rounded */
            width: 90%;
            max-width: 600px; /* Wider */
            max-height: 90vh; /* Taller */
            overflow-y: auto;
            box-shadow: var(--modal-shadow); /* Stronger shadow */
            display: flex;
            flex-direction: column;
            transform: scale(0.9); /* More pronounced scale animation */
            transition: transform 0.3s ease-out;
            border: 1px solid var(--border-color);
        }
        .view-all-modal.active .view-all-content {
            transform: scale(1);
        }
        .view-all-header {
            padding: 1.25rem 2rem; /* Increased padding */
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .view-all-header h3 {
            font-size: 1.75rem; /* Larger title */
            font-weight: 700; /* Bolder */
            color: var(--dark);
        }
        .view-all-header button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 2rem; /* Larger close icon */
            color: var(--gray-medium);
            line-height: 1;
            transition: color 0.2s ease;
        }
        .view-all-header button:hover {
            color: var(--gray-dark);
        }
        .view-all-notification {
            padding: 14px 2rem; /* Increased padding */
            border-bottom: 1px solid #F3F4F6;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }
        .view-all-notification:last-child {
            border-bottom: none;
        }
        .view-all-notification.unread {
            background-color: #EEF2FF;
        }
        .view-all-notification:hover {
            background-color: #F9FAFB;
        }
        .view-all-notification.unread:hover {
            background-color: #E0E7FF;
        }
        .view-all-notification .title {
            font-weight: 600;
            color: var(--gray-dark);
            margin-bottom: 6px;
            font-size: 0.95rem;
        }
        .view-all-notification .time {
            font-size: 0.7rem;
            color: var(--gray-medium);
        }
        .view-all-footer {
            padding: 1.25rem 2rem;
            border-top: 1px solid var(--gray-light);
            text-align: right;
        }
        .view-all-footer button {
            background-color: var(--primary);
            color: white;
            padding: 0.85rem 1.75rem; /* Increased padding */
            border-radius: 0.75rem; /* More rounded */
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(59, 48, 163, 0.2);
        }
        .view-all-footer button:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 6px 15px rgba(59, 48, 163, 0.3);
        }

        /* Avatar Placeholder */
        .avatar-placeholder {
            background-color: #EEF2FF;
            color: var(--primary);
        }

        /* Calendar styles (from original file, adjusted for new palette) */
        .fc {
            font-family: 'Inter', sans-serif;
        }
        .fc-toolbar-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 1.5rem; /* Larger title */
        }
        .fc-button {
            background-color: var(--primary) !important;
            border: none !important;
            color: white !important; /* Ensure button text is white */
            padding: 0.6rem 1.2rem; /* Adjust padding */
            border-radius: 0.6rem; /* Rounded corners */
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .fc-button:hover {
            background-color: var(--primary-dark) !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .fc-button-active {
            background-color: var(--primary-dark) !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }
        .fc-event {
            cursor: pointer;
            border-radius: 6px; /* More rounded */
            font-size: 0.875rem;
            padding: 3px 6px; /* Increased padding */
            border: none !important; /* Remove default border */
            opacity: 0.9;
            transition: opacity 0.2s ease, transform 0.1s ease;
        }
        .fc-event:hover {
            opacity: 1;
            transform: translateY(-1px);
        }
        .fc-daygrid-day-number {
            font-weight: 600;
            color: var(--gray-dark);
            font-size: 1.1rem; /* Larger day numbers */
        }
        .fc-day-today {
            background-color: #EEF2FF !important; /* Light indigo for today */
            border-radius: 0.75rem; /* More rounded */
        }
        .fc-day-today .fc-daygrid-day-number {
            color: var(--primary-dark);
        }

        /* Holiday specific styling */
        .fc-event.holiday {
            background-color: #DC2626 !important; /* Red 600 for holidays */
            border-color: #B91C1C !important; /* Red 700 */
            color: white !important;
            font-weight: 600;
        }
        .holiday-list-item {
            padding: 0.85rem 1.25rem; /* Increased padding */
            border-bottom: 1px solid var(--gray-light);
            border-radius: 0.75rem; /* Consistent with cards */
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--dark);
            background-color: #ffffff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
            transition: all 0.2s ease;
        }
        .holiday-list-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .holiday-list-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        .holiday-list-item .date {
            font-weight: 600;
            color: var(--primary-dark);
            min-width: 90px; /* Slightly wider */
            font-size: 0.95rem;
        }
        .holiday-list-item .name {
            flex-grow: 1;
            font-size: 0.95rem;
        }
        .holiday-list-item .fas {
            color: var(--accent); /* Accent color for star */
        }


        /* Tabs styling */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 2rem; /* Increased margin */
            padding-bottom: 0.25rem; /* Space for active tab border */
        }
        .tab {
            padding: 0.85rem 1.75rem; /* Increased padding */
            cursor: pointer;
            border-bottom: 3px solid transparent; /* Thicker border */
            margin-right: 0.75rem; /* Increased margin */
            font-weight: 500;
            color: var(--gray-medium);
            transition: all 0.2s ease;
            border-radius: 0.5rem 0.5rem 0 0; /* Rounded top corners */
        }
        .tab:hover {
            color: var(--primary-dark);
            background-color: #F3F4F6;
        }
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background-color: #EEF2FF; /* Light indigo background */
            font-weight: 600;
        }

        /* User Dropdown Styles */
        .user-dropdown {
            position: absolute;
            top: 70px; /* Aligned with notification dropdown */
            right: 25px;
            background-color: white;
            border-radius: 1rem;
            box-shadow: var(--modal-shadow);
            width: 220px; /* Slightly wider */
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
            border: 1px solid var(--border-color);
        }
        .user-dropdown.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        .user-dropdown-item {
            padding: 14px 1.5rem; /* Increased padding */
            display: flex;
            align-items: center;
            gap: 1rem; /* Increased gap */
            color: var(--gray-dark);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }
        .user-dropdown-item:hover {
            background-color: #F3F4F6;
        }
        .user-dropdown-item:first-child {
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
        }
        .user-dropdown-item:last-child {
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
        }
        .user-dropdown-item i {
            font-size: 1.15rem; /* Consistent icon size */
            color: var(--gray-medium);
        }
        .user-dropdown-item:hover i {
            color: var(--primary);
        }

        /* Table Styling */
        table {
            width: 100%;
            border-collapse: separate; /* Allows border-radius on cells */
            border-spacing: 0;
        }
        thead th {
            background-color: #F9FAFB; /* Light background for header */
            color: var(--gray-dark);
            font-weight: 600;
            padding: 1rem 1.25rem; /* Increased padding */
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        tbody td {
            padding: 1rem 1.25rem; /* Increased padding */
            border-bottom: 1px solid #F3F4F6; /* Lighter border for rows */
            color: var(--dark);
            font-size: 0.95rem;
        }
        tbody tr:last-child td {
            border-bottom: none;
        }
        tbody tr:hover {
            background-color: #F9FAFB; /* Subtle hover effect */
        }
        .table-actions button {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .table-actions button i {
            margin-right: 0.25rem;
        }
        .table-actions .text-blue-600:hover { color: var(--primary-dark); background-color: #EEF2FF; }
        .table-actions .text-red-600:hover { color: #B91C1C; background-color: #FEE2E2; }
        .table-actions .text-purple-600:hover { color: #7E22CE; background-color: #F3E8FF; }
        .table-actions .text-green-600:hover { color: #065F46; background-color: #D1FAE5; }
        .table-actions .text-orange-600:hover { color: #9A3412; background-color: #FFEDD5; }
        .table-actions .text-pink-600:hover { color: #9D174D; background-color: #FCE7F3; }

        /* Form elements within modules */
        .module-content input,
        .module-content select,
        .module-content textarea {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.6rem;
            font-size: 1rem;
            color: var(--dark);
            background-color: #ffffff;
            transition: all 0.2s ease;
        }
        .module-content input:focus,
        .module-content select:focus,
        .module-content textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 48, 163, 0.1);
        }
        .module-content label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--gray-dark);
            margin-bottom: 0.4rem;
        }

        /* Buttons within modules */
        .module-content button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.6rem;
            font-weight: 600;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .module-content button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .module-content button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .module-content .bg-blue-600:hover { background-color: var(--primary-dark); }
        .module-content .bg-green-600:hover { background-color: #065F46; }
        .module-content .bg-purple-600:hover { background-color: #7E22CE; }
        .module-content .bg-pink-600:hover { background-color: #9D174D; }
        .module-content .bg-orange-500:hover { background-color: var(--accent); }
        .module-content .bg-indigo-600:hover { background-color: var(--primary-dark); }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100%;
                z-index: 100;
                width: 280px; /* Slightly wider for mobile */
                box-shadow: 0 0 20px rgba(0,0,0,0.2);
            }
            .sidebar.active {
                left: 0;
            }
            .notification-dropdown, .user-dropdown {
                right: 15px;
                width: calc(100% - 30px);
            }
            .view-all-content {
                width: calc(100% - 40px);
            }
            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            }
            .tab {
                flex-shrink: 0; /* Prevent tabs from shrinking */
            }
            .grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4 {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            .grid-cols-1.md\:grid-cols-2.lg\:grid-cols-3 {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
            .grid-cols-1.lg\:grid-cols-2 {
                grid-template-columns: 1fr;
            }
            .lg\:col-span-2, .lg\:col-span-1 {
                grid-column: auto;
            }
            .login-container {
                padding: 2.5rem;
                margin: 0 1rem;
            }
            .modal-content {
                padding: 2.5rem;
                margin: 0 1rem;
            }
            header {
                padding: 1rem 1.5rem;
            }
            header h2 {
                font-size: 1.4rem;
            }
            .module-content {
                padding: 1.5rem;
            }
            .module-card {
                padding: 1.5rem;
            }
            .module-card .icon-wrapper {
                font-size: 1.2rem;
            }
            .holiday-list-item {
                padding: 0.75rem 1rem;
            }
            .holiday-list-item .date, .holiday-list-item .name {
                font-size: 0.9rem;
            }
            thead th, tbody td {
                padding: 0.8rem 1rem;
                font-size: 0.85rem;
            }
        }
    </style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<!-- Login UI -->
<div id="login-ui">
<div class="login-container">
<div class="login-header">
<img alt="SchoolPulse Logo" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/e9554fd1-c066-4325-a649-08e555ad308c.png"/>
<h1>Tapowan Public School</h1>
<p class="text-sm text-gray-500" id="typed-welcome"></p>
<p class="text-gray-600 mt-2">Sign in to your account</p>
</div>
<div class="role-selection">
<button class="role-button active" data-role="admin" type="button">
<i class="fas fa-user-shield"></i>
<span>Admin</span>
</button>
<button class="role-button" data-role="teacher" type="button">
<i class="fas fa-chalkboard-teacher"></i>
<span>Teacher</span>
</button>
<button class="role-button" data-role="student" type="button">
<i class="fas fa-user-graduate"></i>
<span>Student</span>
</button>
</div>
<form id="loginForm">
<input id="selectedRole" name="role" type="hidden" value="admin"/>
<div class="form-group">
<label for="username">Username</label>
<input id="email" name="email" placeholder="mdtfansari@gmail.com" required="" type="email"/>
</div>
<div class="form-group">
<label for="password">Password</label>
<input id="password" name="password" placeholder="12345678" required="" type="password"/>
</div>
<button class="login-button" type="submit">Login</button>
<button class="mt-4 rounded-full p-2 bg-indigo-600 text-white" onclick="startVoiceAssistant()"><i class="fas fa-microphone"></i></button>
</form>
<div class="forgot-password">
<a href="#" id="forgotPasswordLink">Forgot Password?</a>
</div>
</div>
</div>
<!-- Forgot Password Modal -->
<div class="modal-overlay" id="forgotPasswordModal">
<div class="modal-content">
<button class="modal-close-button" id="closeForgotPasswordModal">Ã—</button>
<h2>Forgot Password</h2>
<p>Enter your email address below and we'll send you a link to reset your password.</p>
<form id="forgotPasswordForm">
<div class="form-group">
<label for="forgotEmail">Email Address</label>
<input id="forgotEmail" name="forgotEmail" placeholder="your.email@example.com" required="" type="email"/>
</div>
<button class="login-button" type="submit">Send Reset Link</button>
</form>
</div>
</div>
<!-- School Site UI -->
<div id="school-site-ui">
<div class="flex h-screen overflow-hidden">
<!-- Sidebar -->
<div class="sidebar w-64 bg-white shadow-md flex flex-col animate-slideInFromLeft">
<!-- Logo -->
<div class="logo-section flex items-center space-x-3">
<img alt="SchoolPulse Logo" class="rounded-lg animate-popIn" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/e9554fd1-c066-4325-a649-08e555ad308c.png"/>
<h1 class="font-bold animate-fadeIn" style="animation-delay: 0.2s;">Tapowan Public School</h1>
</div>
<!-- Navigation -->
<nav class="flex-1 overflow-y-auto">
<div class="space-y-1 nav-section">
<h3 class="uppercase font-medium animate-fadeIn" style="animation-delay: 0.3s;">MAIN MENU</h3>
<a class="nav-item active animate-slideInFromLeft" data-module="dashboard" href="#" style="animation-delay: 0.4s;">
<i class="fas fa-tachometer-alt"></i>
<span>Dashboard</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="profile" href="#profile" style="animation-delay: 0.5s;">
<i class="fas fa-user-circle"></i>
<span>Profile</span>
</a>
</div>
<div class="space-y-1 mt-6 nav-section">
<h3 class="uppercase font-medium animate-fadeIn" style="animation-delay: 0.6s;">MODULES</h3>
<a class="nav-item animate-slideInFromLeft" data-module="students" href="#students" style="animation-delay: 0.7s;">
<i class="fas fa-user-graduate"></i>
<span>Students</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="teachers" href="#teachers" style="animation-delay: 0.8s;">
<i class="fas fa-chalkboard-teacher"></i>
<span>Teachers</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="payroll" href="#payroll" style="animation-delay: 0.9s;">
<i class="fas fa-money-bill-wave"></i>
<span>Payroll</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="finance" href="#finance" style="animation-delay: 1.0s;">
<i class="fas fa-file-invoice-dollar"></i>
<span>Finance</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="attendance" href="#attendance" style="animation-delay: 1.05s;">
<i class="fas fa-check-circle"></i>
<span>Attendance</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="teacher-attendance" href="#teacher-attendance" style="animation-delay: 1.15s;">
<i class="fas fa-user-check"></i>
<span>Teacher Attendance</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="calendar" href="#calendar" style="animation-delay: 1.1s;">
<i class="fas fa-calendar-alt"></i>
<span>Calendar</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="reports" href="#reports" style="animation-delay: 1.2s;">
<i class="fas fa-chart-line"></i>
<span>Reports</span>
</a>
</div>
<div class="space-y-1 mt-6 nav-section">
<h3 class="uppercase font-medium animate-fadeIn" style="animation-delay: 1.3s;">ADMIN</h3>
<a class="nav-item animate-slideInFromLeft" data-module="user-management" href="#user-management" style="animation-delay: 1.4s;">
<i class="fas fa-users-cog"></i>
<span>User Management</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="roles-permissions" href="#roles-permissions" style="animation-delay: 1.5s;">
<i class="fas fa-user-shield"></i>
<span>Roles &amp; Permissions</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="system-settings" href="#system-settings" style="animation-delay: 1.6s;">
<i class="fas fa-cogs"></i>
<span>System Settings</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="audit-logs" href="#audit-logs" style="animation-delay: 1.7s;">
<i class="fas fa-clipboard-list"></i>
<span>Audit Logs</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="backup-restore" href="#backup-restore" style="animation-delay: 1.8s;">
<i class="fas fa-database"></i>
<span>Backup &amp; Restore</span>
</a>
<a class="nav-item animate-slideInFromLeft" data-module="announcements" href="#announcements" style="animation-delay: 1.9s;">
<i class="fas fa-bullhorn"></i>
<span>Announcements</span>
</a>
</div>
</nav>
</div>
<!-- Main Content -->
<div class="flex-1 overflow-auto">
<!-- Top Bar -->
<header class="bg-white shadow-sm flex justify-between items-center relative animate-slideInFromTop">
<h2 id="currentModuleTitle">Dashboard</h2>
<div class="flex items-center space-x-4">
<button class="p-2 rounded-full hover:bg-gray-100 relative" id="notificationButton">
<i class="fas fa-bell text-gray-600"></i>
<span class="absolute top-0 right-0 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-white bg-red-600 rounded-full" id="notificationCount">3</span>
</button>
<!-- NEW: Dark Mode Toggle -->
<button class="p-2 rounded-full hover:bg-gray-100" id="darkModeToggle">
<i class="fas fa-moon text-gray-600"></i> <!-- Moon icon for light mode -->
</button>
<!-- Notification Dropdown UI -->
<div class="notification-dropdown" id="notificationDropdown">
<div class="header flex justify-between items-center">
<h4>Notifications</h4>
<span class="text-sm text-gray-500" id="newCount">3 New</span>
</div>
<div class="notification-list" id="notificationList">
<!-- Notifications will be inserted here dynamically -->
</div>
<div class="notification-footer">
<button id="markAllReadBtn">Mark all as read</button>
<a href="#" id="viewAllNotificationsLink">View all</a>
</div>
</div>
<!-- End Notification Dropdown UI -->
<div class="flex items-center space-x-2 cursor-pointer p-2 rounded-md hover:bg-gray-100" id="userProfileToggle">
<div class="avatar-placeholder w-8 h-8 rounded-full flex items-center justify-center">
<i class="fas fa-user text-sm"></i>
</div>
<span class="font-medium" id="loggedInUserName">Admin</span>
<i class="fas fa-chevron-down text-xs text-gray-500"></i>
</div>
<!-- User Dropdown UI -->
<div class="user-dropdown" id="userDropdown">
<div class="user-dropdown-item" data-module="profile">
<i class="fas fa-user-cog"></i>
<span>Profile Settings</span>
</div>
<div class="user-dropdown-item" id="logoutButton">
<i class="fas fa-sign-out-alt"></i>
<span>Logout</span>
</div>
</div>
<!-- End User Dropdown UI -->
</div>
</header>
<!-- Dashboard Content -->
<main class="p-6 animate-fadeIn" id="dashboardMainContent" style="animation-delay: 0.5s;">
<!-- Module Tabs -->
<div class="tabs mb-6" id="moduleTabs">
<button class="tab active" data-tab="dashboard">Dashboard</button>
<button class="tab" data-tab="profile">Profile</button>
<button class="tab" data-tab="students">Students</button>
<button class="tab" data-tab="teachers">Teachers</button>
<button class="tab" data-tab="payroll">Payroll</button>
<button class="tab" data-tab="finance">Finance</button>
<button class="tab" data-tab="attendance">Attendance</button>
<button class="tab" data-tab="teacher-attendance">Teacher Attendance</button>
<button class="tab" data-tab="calendar">Calendar</button>
<button class="tab" data-tab="reports">Reports</button>
<button class="tab" data-tab="user-management">User Management</button>
<button class="tab" data-tab="roles-permissions">Roles &amp; Permissions</button>
<button class="tab" data-tab="system-settings">System Settings</button>
<button class="tab" data-tab="audit-logs">Audit Logs</button>
<button class="tab" data-tab="backup-restore">Backup &amp; Restore</button>
<button class="tab" data-tab="announcements">Announcements</button>
</div>
<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
<div class="module-card p-6 animate-popIn" style="animation-delay: 0.6s;">
<div class="flex justify-between items-start">
<div>
<p class="text-gray-500">Total Students</p>
<h3 class="text-2xl font-bold mt-1" id="totalStudentsCount">0</h3>
</div>
<div class="icon-wrapper bg-blue-50 text-blue-600">
<i class="fas fa-user-graduate"></i>
</div>
</div>
</div>
<div class="module-card p-6 animate-popIn" style="animation-delay: 0.7s;">
<div class="flex justify-between items-start">
<div>
<p class="text-gray-500">Total Teachers</p>
<h3 class="text-2xl font-bold mt-1" id="totalTeachersCount">0</h3>
</div>
<div class="icon-wrapper bg-green-50 text-green-600">
<i class="fas fa-chalkboard-teacher"></i>
</div>
</div>
</div>
<div class="module-card p-6 animate-popIn" style="animation-delay: 0.8s;">
<div class="flex justify-between items-start">
<div>
<p class="text-gray-500">Monthly Revenue</p>
<h3 class="text-2xl font-bold mt-1" id="monthlyRevenue">$0.00</h3>
</div>
<div class="icon-wrapper bg-yellow-50 text-yellow-600">
<i class="fas fa-money-bill-wave"></i>
</div>
</div>
</div>
<div class="module-card p-6 animate-popIn" style="animation-delay: 0.9s;">
<div class="flex justify-between items-start">
<div>
<p class="text-gray-500">Upcoming Events</p>
<h3 class="text-2xl font-bold mt-1" id="upcomingEventsCount">0</h3>
</div>
<div class="icon-wrapper bg-purple-50 text-purple-600">
<i class="fas fa-calendar-alt"></i>
</div>
</div>
</div>
</div>
<!-- Modules Section -->
<div class="module-card p-6 mb-8 animate-fadeIn" style="animation-delay: 1.0s;">
<div class="flex justify-between items-center mb-6">
<h3 class="text-lg font-semibold">Quick Access Modules</h3>
<button class="text-blue-600 hover:text-blue-800" data-module="students">View All</button>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
<!-- Students Module -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 1.1s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-blue-50 text-blue-600">
<i class="fas fa-user-graduate"></i>
</div>
<h4 class="font-medium">Students</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Manage student records, attendance, and performance</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="students">Open Module</button>
</div>
<!-- Teachers Module -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 1.2s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-green-50 text-green-600">
<i class="fas fa-chalkboard-teacher"></i>
</div>
<h4 class="font-medium">Teachers</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Manage faculty information and class assignments</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="teachers">Open Module</button>
</div>
<!-- Payroll Module -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 1.3s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-yellow-50 text-yellow-600">
<i class="fas fa-money-bill-wave"></i>
</div>
<h4 class="font-medium">Payroll</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Process salaries and manage staff payments</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="payroll">Open Module</button>
</div>
<!-- Finance Module -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 1.4s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-purple-50 text-purple-600">
<i class="fas fa-file-invoice-dollar"></i>
</div>
<h4 class="font-medium">Finance</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Generate invoices and manage school finances</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="finance">Open Module</button>
</div>
<!-- Attendance Module -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 1.45s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-indigo-50 text-indigo-600">
<i class="fas fa-check-circle"></i>
</div>
<h4 class="font-medium">Attendance</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Track and manage student attendance records</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="attendance">Open Module</button>
</div>
<!-- Calendar Module -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 1.5s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-red-50 text-red-600">
<i class="fas fa-calendar-alt"></i>
</div>
<h4 class="font-medium">Calendar</h4>
</div>
<p class="text-gray-500 text-sm mb-3">View and manage school events and schedules</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="calendar">Open Module</button>
</div>
<!-- Reports Module -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 1.6s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-indigo-50 text-indigo-600">
<i class="fas fa-chart-line"></i>
</div>
<h4 class="font-medium">Reports</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Generate insights and analytics</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="reports">Open Module</button>
</div>
</div>
</div>
<!-- Admin Options Section -->
<div class="module-card p-6 mb-8 animate-fadeIn" style="animation-delay: 1.7s;">
<div class="flex justify-between items-center mb-6">
<h3 class="text-lg font-semibold">Admin Options</h3>
<button class="text-blue-600 hover:text-blue-800" data-module="user-management">View All</button>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
<!-- User Management -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 1.8s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-red-50 text-red-600">
<i class="fas fa-users-cog"></i>
</div>
<h4 class="font-medium">User Management</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Add, edit, or remove user accounts</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="user-management">Open Module</button>
</div>
<!-- Role & Permissions -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 1.9s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-orange-50 text-orange-600">
<i class="fas fa-user-shield"></i>
</div>
<h4 class="font-medium">Role &amp; Permissions</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Define and assign user roles and access rights</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="roles-permissions">Open Module</button>
</div>
<!-- System Settings -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 2.0s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-green-50 text-green-600">
<i class="fas fa-cogs"></i>
</div>
<h4 class="font-medium">System Settings</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Configure general application settings</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="system-settings">Open Module</button>
</div>
<!-- Audit Logs -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 2.1s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-blue-50 text-blue-600">
<i class="fas fa-clipboard-list"></i>
</div>
<h4 class="font-medium">Audit Logs</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Review system activity and user actions</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="audit-logs">Open Module</button>
</div>
<!-- Backup & Restore -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 2.2s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-purple-50 text-purple-600">
<i class="fas fa-database"></i>
</div>
<h4 class="font-medium">Backup &amp; Restore</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Manage database backups and restoration</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="backup-restore">Open Module</button>
</div>
<!-- Announcements -->
<div class="module-card p-4 animate-popIn" style="animation-delay: 2.3s;">
<div class="flex items-center space-x-4 mb-3">
<div class="icon-wrapper bg-pink-50 text-pink-600">
<i class="fas fa-bullhorn"></i>
</div>
<h4 class="font-medium">Announcements</h4>
</div>
<p class="text-gray-500 text-sm mb-3">Create and manage school-wide announcements</p>
<button class="text-blue-600 text-sm font-medium open-module" data-module="announcements">Open Module</button>
</div>
</div>
</div>
<!-- Recent Activity and Calendar -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<!-- Recent Activity -->
<div class="module-card p-6 animate-fadeIn" style="animation-delay: 2.4s;">
<h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
<div class="space-y-4" id="recentActivityList">
<!-- Activities will be dynamically loaded here -->
</div>
</div>
<!-- Calendar -->
<div class="module-card p-6 animate-fadeIn" style="animation-delay: 2.8s;">
<h3 class="text-lg font-semibold mb-4">School Calendar</h3>
<div class="min-h-[400px] fc-theme-standard" id="calendar"></div>
</div>
</div>
</main>
<!-- Module Containers -->
<div class="hidden" id="modulesContainer">
<!-- Profile Module -->
<div class="module-content p-6" id="profileModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">User Profile</h3>
<button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" form="profileForm" type="submit">
<i class="fas fa-save mr-2"></i>Save Changes
                            </button>
</div>
<div class="module-card p-6">
<form class="space-y-6" id="profileForm">
<div class="flex items-center space-x-6">
<div class="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden">
<img alt="Profile Picture" class="w-full h-full object-cover" id="profilePicturePreview" src="https://via.placeholder.com/96"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="profilePicture">Change Profile Picture</label>
<input accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" id="profilePicture" name="profilePicture" type="file">
</input></div>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="fullName">Full Name</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="fullName" name="fullName" required="" type="text" value="Admin User">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="email">Email Address</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="email" name="email" required="" type="email" value="admin@tps.com">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="role">Role</label>
<select class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="role" name="role">
<option value="Admin">Admin</option>
<option value="Teacher">Teacher</option>
<option value="Student">Student</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="phone">Phone Number</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="phone" name="phone" type="tel" value="+123 456 7890">
</input></div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="address">Address</label>
<textarea class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="address" name="address" rows="3">123 School Lane, Education City</textarea>
</div>
</form>
</div>
</div>
<!-- User Management Module -->
<div class="module-content p-6" id="user-managementModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">User Management</h3>
<button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" onclick="showAddUserForm()">
<i class="fas fa-plus mr-2"></i>Add User
                            </button>
</div>
<div class="module-card p-6">
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">ID</th>
<th class="text-left py-3 px-4">Name</th>
<th class="text-left py-3 px-4">Email</th>
<th class="text-left py-3 px-4">Role</th>
<th class="text-left py-3 px-4">Status</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody id="userTableBody">
<!-- Users will be dynamically loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Role & Permissions Module -->
<div class="module-content p-6" id="roles-permissionsModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Role &amp; Permissions Management</h3>
<button class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700" onclick="alert('Add New Role functionality goes here!')">
<i class="fas fa-plus mr-2"></i>Add New Role
                            </button>
</div>
<div class="module-card p-6">
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">Role Name</th>
<th class="text-left py-3 px-4">Description</th>
<th class="text-left py-3 px-4">Permissions</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody>
<tr class="border-b hover:bg-gray-50">
<td class="py-3 px-4">Admin</td>
<td class="py-3 px-4">Full access to all modules and settings.</td>
<td class="py-3 px-4">All</td>
<td class="py-3 px-4">
<button class="text-blue-600 hover:text-blue-800 mr-3" title="Edit Role">
<i class="fas fa-edit"></i>
</button>
<button class="text-purple-600 hover:text-purple-800" title="Manage Permissions">
<i class="fas fa-user-shield"></i>
</button>
</td>
</tr>
<tr class="border-b hover:bg-gray-50">
<td class="py-3 px-4">Teacher</td>
<td class="py-3 px-4">Manage students, grades, and attendance for assigned classes.</td>
<td class="py-3 px-4">Students, Calendar, Reports</td>
<td class="py-3 px-4">
<button class="text-blue-600 hover:text-blue-800 mr-3" title="Edit Role">
<i class="fas fa-edit"></i>
</button>
<button class="text-purple-600 hover:text-purple-800" title="Manage Permissions">
<i class="fas fa-user-shield"></i>
</button>
</td>
</tr>
<tr class="border-b hover:bg-gray-50">
<td class="py-3 px-4">Student</td>
<td class="py-3 px-4">View personal profile, grades, and school calendar.</td>
<td class="py-3 px-4">Profile, Calendar</td>
<td class="py-3 px-4">
<button class="text-blue-600 hover:text-blue-800 mr-3" title="Edit Role">
<i class="fas fa-edit"></i>
</button>
<button class="text-purple-600 hover:text-purple-800" title="Manage Permissions">
<i class="fas fa-user-shield"></i>
</button>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<!-- System Settings Module -->
<div class="module-content p-6" id="system-settingsModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">System Settings</h3>
<button class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" form="systemSettingsForm" type="submit">
<i class="fas fa-save mr-2"></i>Save Settings
                            </button>
</div>
<div class="module-card p-6">
<form class="space-y-6" id="systemSettingsForm">
<h4 class="text-lg font-medium text-gray-700 mb-3">General Settings</h4>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="schoolName">School Name</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" id="schoolName" name="schoolName" required="" type="text" value="Tapowan Public School"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="schoolAddress">School Address</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" id="schoolAddress" name="schoolAddress" required="" type="text" value="123 Education Lane, School City"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="contactEmail">Contact Email</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" id="contactEmail" name="contactEmail" required="" type="email" value="info@tps.com"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="contactPhone">Contact Phone</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" id="contactPhone" name="contactPhone" type="tel" value="+1 (555) 123-4567"/>
</div>
</div>
<h4 class="text-lg font-medium text-gray-700 mb-3 mt-8">Email Settings</h4>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="smtpHost">SMTP Host</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" id="smtpHost" name="smtpHost" type="text" value="smtp.example.com"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="smtpPort">SMTP Port</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" id="smtpPort" name="smtpPort" type="number" value="587"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="smtpUsername">SMTP Username</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" id="smtpUsername" name="smtpUsername" type="text" value="noreply@schoolpulse.com"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="smtpPassword">SMTP Password</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" id="smtpPassword" name="smtpPassword" type="password" value="********"/>
</div>
</div>
</form>
</div>
</div>
<!-- Audit Logs Module -->
<div class="module-content p-6" id="audit-logsModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Audit Logs</h3>
<div class="flex items-center space-x-4">
<input class="p-2 border border-gray-300 rounded-lg" type="date"/>
<input class="p-2 border border-gray-300 rounded-lg" type="date"/>
<button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
<i class="fas fa-filter mr-2"></i>Filter
                                </button>
</div>
</div>
<div class="module-card p-6">
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">Timestamp</th>
<th class="text-left py-3 px-4">User</th>
<th class="text-left py-3 px-4">Action</th>
<th class="text-left py-3 px-4">Module</th>
<th class="text-left py-3 px-4">Details</th>
</tr>
</thead>
<tbody id="auditLogTableBody">
<!-- Audit logs will be dynamically loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Backup & Restore Module -->
<div class="module-content p-6" id="backup-restoreModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Backup &amp; Restore</h3>
<button class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700" onclick="alert('Initiating database backup...')">
<i class="fas fa-database mr-2"></i>Create New Backup
                            </button>
</div>
<div class="module-card p-6">
<h4 class="text-lg font-medium text-gray-700 mb-3">Backup History</h4>
<div class="overflow-x-auto mb-6">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">Backup ID</th>
<th class="text-left py-3 px-4">Date</th>
<th class="text-left py-3 px-4">Size</th>
<th class="text-left py-3 px-4">Type</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody id="backupTableBody">
<!-- Backups will be dynamically loaded here -->
</tbody>
</table>
</div>
<h4 class="text-lg font-medium text-gray-700 mb-3">Manual Restore</h4>
<div class="flex items-center space-x-4">
<input accept=".sql,.zip" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-50 file:text-gray-700 hover:file:bg-gray-100" type="file">
<button class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" onclick="alert('Initiating manual restore...')">
<i class="fas fa-upload mr-2"></i>Upload &amp; Restore
                                </button>
</input></div>
</div>
</div>
<!-- Announcements Module -->
<div class="module-content p-6" id="announcementsModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Announcements</h3>
<button class="bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700" onclick="showAddAnnouncementModal()">
<i class="fas fa-plus mr-2"></i>Add New Announcement
                            </button>
</div>
<div class="module-card p-6">
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">Title</th>
<th class="text-left py-3 px-4">Content</th>
<th class="text-left py-3 px-4">Date Posted</th>
<th class="text-left py-3 px-4">Status</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody id="announcementTableBody">
<!-- Announcements will be dynamically loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Students Module -->
<div class="module-content p-6" id="studentsModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Students Management</h3>
<button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700" onclick="showAddStudentForm()">
<i class="fas fa-plus mr-2"></i>Add Student
                            </button>
</div>
<div class="module-card p-6">
<div class="flex flex-wrap items-center gap-4 mb-4">
<input class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:w-auto" id="searchRoll" placeholder="Search by Roll No." type="text"/>
<select class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:w-auto" id="searchClass">
<option value="">All Classes</option>
<option>Grade 1</option>
<option>Grade 2</option>
<option>Grade 3</option>
<option>Grade 4</option>
<option>Grade 5</option>
<option>Grade 6</option>
<option>Grade 7</option>
<option>Grade 8</option>
<option>Grade 9</option>
<option>Grade 10</option>
<option>Grade 11</option>
<option>Grade 12</option>
</select>
<button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 w-full md:w-auto" id="applySearch">
<i class="fas fa-search mr-2"></i>Search
                                </button>
</div>
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">ID</th>
<th class="text-left py-3 px-4">Name</th>
<th class="text-left py-3 px-4">Father's Name</th>
<th class="text-left py-3 px-4">Mother's Name</th>
<th class="text-left py-3 px-4">Class</th>
<th class="text-left py-3 px-4">Roll No.</th>
<th class="text-left py-3 px-4">Aadhar No.</th>
<th class="text-left py-3 px-4">Status</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody id="studentTableBody">
<!-- Students will be dynamically loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Teachers Module -->
<div class="module-content p-6" id="teachersModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Teachers Management</h3>
<button class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" onclick="showAddTeacherForm()">
<i class="fas fa-plus mr-2"></i>Add Teacher
                            </button>
</div>
<div class="module-card p-6">
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">ID</th>
<th class="text-left py-3 px-4">Name</th>
<th class="text-left py-3 px-4">Subject</th>
<th class="text-left py-3 px-4">Classes</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody id="teacherTableBody">
<!-- Teachers will be dynamically loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Payroll Module -->
<div class="module-content p-6" id="payrollModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Payroll Management</h3>
<button class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 flex items-center space-x-2" id="openPayrollModalBtn">
<i class="fas fa-plus"></i>
<span>Process Payroll</span>
</button>
</div>
<div class="module-card p-6">
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">Period</th>
<th class="text-left py-3 px-4">Staff Count</th>
<th class="text-left py-3 px-4">Total Amount</th>
<th class="text-left py-3 px-4">Status</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody id="payrollTableBody">
<!-- Payroll entries will be dynamically loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Finance Module -->
<div class="module-content p-6" id="financeModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Finance Management</h3>
<button class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center space-x-2" id="openAddInvoiceModalBtn">
<i class="fas fa-plus"></i>
<span>Add Invoice</span>
</button>
</div>
<div class="module-card p-6">
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">Invoice #</th>
<th class="text-left py-3 px-4">Date</th>
<th class="text-left py-3 px-4">Amount</th>
<th class="text-left py-3 px-4">Status</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody id="financeTableBody">
<!-- Invoices will be dynamically loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Attendance Module -->
<div class="module-content p-6" id="attendanceModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Attendance Management</h3>
<button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700" onclick="showAddAttendanceModal()">
<i class="fas fa-plus mr-2"></i>Mark Attendance
                            </button>
</div>
<div class="module-card p-6">
<div class="flex flex-wrap items-center gap-4 mb-4">
<input class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full md:w-auto" id="attendanceStudentNameFilter" placeholder="Search by Student Name" type="text"/>
<select class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full md:w-auto" id="attendanceClassFilter">
<option value="">All Classes</option>
<option>Grade 1</option>
<option>Grade 2</option>
<option>Grade 3</option>
<option>Grade 4</option>
<option>Grade 5</option>
<option>Grade 6</option>
<option>Grade 7</option>
<option>Grade 8</option>
<option>Grade 9</option>
<option>Grade 10</option>
<option>Grade 11</option>
<option>Grade 12</option>
</select>
<input class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full md:w-auto" id="attendanceDateFilter" type="date"/>
<button class="bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600 w-full md:w-auto" id="applyAttendanceFilter">
<i class="fas fa-filter mr-2"></i>Filter
                                </button>
</div>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
<div class="module-card p-4 text-center">
<p class="text-gray-500 text-sm">Total Students</p>
<h4 class="text-xl font-bold" id="attendanceTotalStudents">0</h4>
</div>
<div class="module-card p-4 text-center">
<p class="text-gray-500 text-sm">Present</p>
<h4 class="text-xl font-bold text-green-600" id="attendanceTotalPresent">0</h4>
</div>
<div class="module-card p-4 text-center">
<p class="text-gray-500 text-sm">Absent</p>
<h4 class="text-xl font-bold text-red-600" id="attendanceTotalAbsent">0</h4>
</div>
</div>
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">Student Name</th>
<th class="text-left py-3 px-4">Roll No.</th>
<th class="text-left py-3 px-4">Class</th>
<th class="text-left py-3 px-4">Date</th>
<th class="text-left py-3 px-4">Status</th>
<th class="text-left py-3 px-4">Remarks</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody id="attendanceTableBody">
<!-- Attendance records will be dynamically loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Teacher Attendance Module -->
<div class="module-content p-6" id="teacher-attendanceModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Teacher Attendance Management</h3>
<button class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700" onclick="showAddTeacherAttendanceModal()">
<i class="fas fa-plus mr-2"></i>Mark Teacher Attendance
                            </button>
</div>
<div class="module-card p-6">
<div class="flex flex-wrap items-center gap-4 mb-4">
<input class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 w-full md:w-auto" id="teacherAttendanceNameFilter" placeholder="Search by Teacher Name" type="text"/>
<select class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 w-full md:w-auto" id="teacherAttendanceSubjectFilter">
<option value="">All Subjects</option>
<option>English</option>
<option>Hindi</option>
<option>Science</option>
<option>Math</option>
<option>Computer</option>
<option>Sanskrit</option>
<option>Social Study</option>
<option>Soil Science</option>
</select>
<input class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 w-full md:w-auto" id="teacherAttendanceDateFilter" type="date"/>
<button class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 w-full md:w-auto" id="applyTeacherAttendanceFilter">
<i class="fas fa-filter mr-2"></i>Filter
                                </button>
</div>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
<div class="module-card p-4 text-center">
<p class="text-gray-500 text-sm">Total Teachers</p>
<h4 class="text-xl font-bold" id="teacherAttendanceTotalTeachers">0</h4>
</div>
<div class="module-card p-4 text-center">
<p class="text-gray-500 text-sm">Present</p>
<h4 class="text-xl font-bold text-green-600" id="teacherAttendanceTotalPresent">0</h4>
</div>
<div class="module-card p-4 text-center">
<p class="text-gray-500 text-sm">Absent</p>
<h4 class="text-xl font-bold text-red-600" id="teacherAttendanceTotalAbsent">0</h4>
</div>
</div>
<div class="overflow-x-auto">
<table class="min-w-full">
<thead>
<tr class="border-b">
<th class="text-left py-3 px-4">Teacher Name</th>
<th class="text-left py-3 px-4">Subject</th>
<th class="text-left py-3 px-4">Date</th>
<th class="text-left py-3 px-4">Status</th>
<th class="text-left py-3 px-4">Remarks</th>
<th class="text-left py-3 px-4">Actions</th>
</tr>
</thead>
<tbody id="teacherAttendanceTableBody">
<!-- Teacher attendance records will be dynamically loaded here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Calendar Module -->
<div class="module-content p-6 grid grid-cols-1 lg:grid-cols-3 gap-6" id="calendarModule">
<div class="lg:col-span-2 module-card p-6">
<h3 class="text-2xl font-semibold mb-4 text-gray-800">School Event Calendar</h3>
<div class="min-h-[500px]" id="calendar-full"></div>
</div>
<div class="lg:col-span-1 module-card p-6">
<h3 class="text-2xl font-semibold mb-4 text-gray-800">Upcoming Holidays</h3>
<div class="space-y-2" id="holidayList">
<!-- Holidays will be dynamically loaded here -->
</div>
</div>
</div>
<!-- Reports Module -->
<div class="module-content p-6" id="reportsModule">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-semibold">Reports Dashboard</h3>
<button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700" onclick="alert('Generate Report functionality goes here!')">
<i class="fas fa-plus mr-2"></i>Generate Report
                            </button>
</div>
<div class="module-card p-6">
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="p-4 border rounded-lg">
<h4 class="font-medium mb-3">Student Attendance</h4>
<canvas class="w-full h-64" id="attendanceChart"></canvas>
</div>
<div class="p-4 border rounded-lg">
<h4 class="font-medium mb-3">Exam Performance</h4>
<canvas class="w-full h-64" id="performanceChart"></canvas>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- View All Notifications Modal -->
<div aria-labelledby="viewAllTitle" aria-modal="true" class="view-all-modal" id="viewAllModal" role="dialog" tabindex="-1">
<div class="view-all-content">
<div class="view-all-header">
<h3 id="viewAllTitle">All Notifications</h3>
<button aria-label="Close notifications modal" id="closeViewAllModal">Ã—</button>
</div>
<div class="overflow-y-auto" id="viewAllNotificationList" style="max-height: 60vh;">
<!-- All notifications will be inserted here -->
</div>
<div class="view-all-footer">
<button id="modalMarkAllReadBtn">Mark all as read</button>
</div>
</div>
</div>
<!-- Process Payroll Modal -->
<div class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="payrollModal">
<div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold">Process Payroll</h3>
<button class="text-gray-500 hover:text-gray-700" id="closePayrollModalBtn">
<i class="fas fa-times"></i>
</button>
</div>
<form class="space-y-4" id="payrollForm">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="payrollPeriod">Payroll Period</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" id="payrollPeriod" name="payrollPeriod" required="" type="month">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="staffCount">Staff Count</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" id="staffCount" min="1" name="staffCount" placeholder="Enter number of staff" required="" type="number">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="totalAmount">Total Amount ($)</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" id="totalAmount" min="0" name="totalAmount" placeholder="Enter total payroll amount" required="" step="0.01" type="number">
</input></div>
<button class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 font-semibold" type="submit">
                        Submit Payroll
                    </button>
</form>
</div>
</div>
<!-- Add Invoice Modal -->
<div class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="addInvoiceModal">
<div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold">Add New Invoice</h3>
<button class="text-gray-500 hover:text-gray-700" id="closeAddInvoiceModalBtn">
<i class="fas fa-times"></i>
</button>
</div>
<form class="space-y-4" id="addInvoiceForm">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="invoiceNumber">Invoice #</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" id="invoiceNumber" name="invoiceNumber" placeholder="e.g., INV-2023-0043" required="" type="text">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="invoiceDate">Date</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" id="invoiceDate" name="invoiceDate" required="" type="date">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="invoiceAmount">Amount ($)</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" id="invoiceAmount" min="0" name="invoiceAmount" placeholder="e.g., 1500.00" required="" step="0.01" type="number">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="invoiceStatus">Status</label>
<select class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" id="invoiceStatus" name="invoiceStatus" required="">
<option value="Paid">Paid</option>
<option value="Pending">Pending</option>
<option value="Overdue">Overdue</option>
</select>
</div>
<button class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 font-semibold" type="submit">
                        Add Invoice
                    </button>
</form>
</div>
</div>
<!-- Add/Edit User Modal -->
<div class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="userModal">
<div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold" id="userModalTitle">Add New User</h3>
<button class="text-gray-500 hover:text-gray-700" id="closeUserModal">
<i class="fas fa-times"></i>
</button>
</div>
<form class="space-y-4" id="userForm">
<input id="userId" type="hidden"/>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
<input class="w-full p-2 border rounded-lg" id="userFullName" required="" type="text"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
<input class="w-full p-2 border rounded-lg" id="userEmail" required="" type="email"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
<select class="w-full p-2 border rounded-lg" id="userRole" required="">
<option value="">Select Role</option>
<option>Admin</option>
<option>Teacher</option>
<option>Student</option>
<option>Staff</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
<input class="w-full p-2 border rounded-lg" id="userPassword" placeholder="Leave blank to keep current password" type="password"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
<select class="w-full p-2 border rounded-lg" id="userStatus" required="">
<option value="Active">Active</option>
<option value="Inactive">Inactive</option>
</select>
</div>
<button class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700" id="userFormSubmitBtn" type="submit">
                        Add User
                    </button>
</form>
</div>
</div>
<!-- Add/Edit Announcement Modal -->
<div class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="announcementModal">
<div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold" id="announcementModalTitle">Add New Announcement</h3>
<button class="text-gray-500 hover:text-gray-700" id="closeAnnouncementModal">
<i class="fas fa-times"></i>
</button>
</div>
<form class="space-y-4" id="announcementForm">
<input id="announcementId" type="hidden">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="announcementTitle">Title</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" id="announcementTitle" name="announcementTitle" required="" type="text">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="announcementContent">Content</label>
<textarea class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" id="announcementContent" name="announcementContent" required="" rows="4"></textarea>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="announcementStatus">Status</label>
<select class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" id="announcementStatus" name="announcementStatus" required="">
<option value="Active">Active</option>
<option value="Archived">Archived</option>
</select>
</div>
<button class="w-full bg-pink-600 text-white py-2 rounded-lg hover:bg-pink-700 font-semibold" id="announcementFormSubmitBtn" type="submit">
                        Publish Announcement
                    </button>
</input></form>
</div>
</div>
<!-- Add/Edit Student Modal -->
<div class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="studentModal">
<div class="bg-white rounded-lg p-6 w-full max-w-md">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold" id="studentModalTitle">Add New Student</h3>
<button class="text-gray-500 hover:text-gray-700" id="closeStudentModal">
<i class="fas fa-times"></i>
</button>
</div>
<form class="space-y-4" id="studentForm">
<input id="studentId" type="hidden">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
<input class="w-full p-2 border rounded-lg" id="studentFullName" required="" type="text"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Father's Name</label>
<input class="w-full p-2 border rounded-lg" id="studentFatherName" required="" type="text"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Mother's Name</label>
<input class="w-full p-2 border rounded-lg" id="studentMotherName" required="" type="text"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Class</label>
<select class="w-full p-2 border rounded-lg" id="studentClass" required="">
<option value="">Select Class</option>
<option>Grade 1</option>
<option>Grade 2</option>
<option>Grade 3</option>
<option>Grade 4</option>
<option>Grade 5</option>
<option>Grade 6</option>
<option>Grade 7</option>
<option>Grade 8</option>
<option>Grade 9</option>
<option>Grade 10</option>
<option>Grade 11</option>
<option>Grade 12</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Roll No.</label>
<input class="w-full p-2 border rounded-lg" id="studentRollNo" required="" type="text"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Aadhar No.</label>
<input class="w-full p-2 border rounded-lg" id="studentAadharNo" required="" type="text"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
<input class="w-full p-2 border rounded-lg" id="studentEmail" type="email"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
<input class="w-full p-2 border rounded-lg" id="studentPhone" type="tel"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
<select class="w-full p-2 border rounded-lg" id="studentStatus" required="">
<option value="Active">Active</option>
<option value="Inactive">Inactive</option>
</select>
</div>
<button class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700" id="studentFormSubmitBtn" type="submit">
                        Add Student
                    </button>
</input></form>
</div>
</div>
<!-- Add/Edit Teacher Modal -->
<div class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="teacherModal">
<div class="bg-white rounded-lg p-6 w-full max-w-md">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold" id="teacherModalTitle">Add New Teacher</h3>
<button class="text-gray-500 hover:text-gray-700" id="closeTeacherModal">
<i class="fas fa-times"></i>
</button>
</div>
<form class="space-y-4" id="teacherForm">
<input id="teacherId" type="hidden">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
<input class="w-full p-2 border rounded-lg" id="teacherFullName" required="" type="text"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
<select class="w-full p-2 border rounded-lg" id="teacherSubject" required="">
<option value="">Select Subject</option>
<option>English</option>
<option>Hindi</option>
<option>Science</option>
<option>Math</option>
<option>Computer</option>
<option>Sanskrit</option>
<option>Social Study</option>
<option>Soil Science</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
<input class="w-full p-2 border rounded-lg" id="teacherEmail" required="" type="email"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Classes</label>
<input class="w-full p-2 border rounded-lg" id="teacherClasses" placeholder="Grade 9-10" type="text"/>
</div>
<button class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700" id="teacherFormSubmitBtn" type="submit">
                        Add Teacher
                    </button>
</input></form>
</div>
</div>
<!-- Add/Edit Attendance Modal -->
<div class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="attendanceModal">
<div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold" id="attendanceModalTitle">Mark Attendance</h3>
<button class="text-gray-500 hover:text-gray-700" id="closeAttendanceModal">
<i class="fas fa-times"></i>
</button>
</div>
<form class="space-y-4" id="attendanceForm">
<input id="attendanceId" type="hidden">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="attendanceStudentSelect">Student Name</label>
<select class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" id="attendanceStudentSelect" required="">
<option value="">Select Student</option>
<!-- Students will be dynamically loaded here -->
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="attendanceDate">Date</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" id="attendanceDate" name="attendanceDate" required="" type="date">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="attendanceStatus">Status</label>
<select class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" id="attendanceStatus" name="attendanceStatus" required="">
<option value="Present">Present</option>
<option value="Absent">Absent</option>
<option value="Leave">Leave</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="attendanceRemarks">Remarks (Optional)</label>
<textarea class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" id="attendanceRemarks" name="attendanceRemarks" rows="2"></textarea>
</div>
<div class="flex flex-col space-y-2">
<button class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 font-semibold" id="registerStudentFingerprintBtn" type="button">
<i class="fas fa-fingerprint mr-2"></i>Register Fingerprint
                        </button>
<button class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 font-semibold" id="verifyStudentFingerprintBtn" type="button">
<i class="fas fa-fingerprint mr-2"></i>Verify Fingerprint (Mark Present)
                        </button>
</div>
<button class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 font-semibold" id="attendanceFormSubmitBtn" type="submit">
                        Mark Attendance
                    </button>
</input></form>
</div>
</div>
<!-- Add/Edit Teacher Attendance Modal -->
<div class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="teacherAttendanceModal">
<div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold" id="teacherAttendanceModalTitle">Mark Teacher Attendance</h3>
<button class="text-gray-500 hover:text-gray-700" id="closeTeacherAttendanceModal">
<i class="fas fa-times"></i>
</button>
</div>
<form class="space-y-4" id="teacherAttendanceForm">
<input id="teacherAttendanceId" type="hidden">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="teacherAttendanceTeacherSelect">Teacher Name</label>
<select class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" id="teacherAttendanceTeacherSelect" required="">
<option value="">Select Teacher</option>
<!-- Teachers will be dynamically loaded here -->
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="teacherAttendanceDate">Date</label>
<input class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" id="teacherAttendanceDate" name="teacherAttendanceDate" required="" type="date">
</input></div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="teacherAttendanceStatus">Status</label>
<select class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" id="teacherAttendanceStatus" name="teacherAttendanceStatus" required="">
<option value="Present">Present</option>
<option value="Absent">Absent</option>
<option value="Leave">Leave</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="teacherAttendanceRemarks">Remarks (Optional)</label>
<textarea class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" id="teacherAttendanceRemarks" name="teacherAttendanceRemarks" rows="2"></textarea>
</div>
<div class="flex flex-col space-y-2">
<button class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 font-semibold" id="registerTeacherFingerprintBtn" type="button">
<i class="fas fa-fingerprint mr-2"></i>Register Fingerprint
                        </button>
<button class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 font-semibold" id="verifyTeacherFingerprintBtn" type="button">
<i class="fas fa-fingerprint mr-2"></i>Verify Fingerprint (Mark Present)
                        </button>
</div>
<button class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 font-semibold" id="teacherAttendanceFormSubmitBtn" type="submit">
                        Mark Attendance
                    </button>
</input></form>
</div>
</div>
</div>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Data Storage (Simulated Database) ---
            let users = [];
            let students = [];
            let teachers = [];
            let payrollEntries = [];
            let invoices = [];
            let announcements = [];
            let notifications = [];
            let auditLogs = [];
            let backups = [];
            let attendanceRecords = []; // New: Attendance Records
            let teacherAttendanceRecords = []; // New: Teacher Attendance Records

            // --- Utility Functions for localStorage ---
            function loadDataFromLocalStorage() {
                users = JSON.parse(null) || [
                    { id: 'U001', name: 'Admin', email: 'admin@tps.com', role: 'Admin', status: 'Active', password: 'Aatif@123' },
                    { id: 'U002', name: 'Teacher', email: 'jane.doe@school.com', role: 'Teacher', status: 'Active', password: 'Aatif@123' },
                    { id: 'U003', name: 'Student', email: 'john.smith@school.com', role: 'Student', status: 'Active', password: 'Aatif@123' }
                ];
                students = JSON.parse(null) || [
                    { id: 'S1001', name: 'Emily Johnson', fatherName: 'David Johnson', motherName: 'Sarah Johnson', class: 'Grade 10', rollNo: '001', aadharNo: '1234 5678 9012', email: 'emily.j@example.com', phone: '555-111-2222', status: 'Active', fingerprintCredential: null },
                    { id: 'S1002', name: 'Michael Brown', fatherName: 'James Brown', motherName: 'Linda Brown', class: 'Grade 9', rollNo: '002', aadharNo: '9876 5432 1098', email: 'michael.b@example.com', phone: '555-333-4444', status: 'Active', fingerprintCredential: null },
                    { id: 'S1003', name: 'Jessica Davis', fatherName: 'Robert Davis', motherName: 'Patricia Davis', class: 'Grade 10', rollNo: '003', aadharNo: '1122 3344 5566', email: 'jessica.d@example.com', phone: '555-555-6666', status: 'Active', fingerprintCredential: null },
                    { id: 'S1004', name: 'Daniel Wilson', fatherName: 'Charles Wilson', motherName: 'Mary Wilson', class: 'Grade 9', rollNo: '004', aadharNo: '7788 9900 1122', email: 'daniel.w@example.com', phone: '555-777-8888', status: 'Active', fingerprintCredential: null },
                    { id: 'S1005', name: 'Sophia Miller', fatherName: 'Thomas Miller', motherName: 'Nancy Miller', class: 'Grade 10', rollNo: '005', aadharNo: '3344 5566 7788', email: 'sophia.m@example.com', phone: '555-999-0000', status: 'Active', fingerprintCredential: null }
                ];
                teachers = JSON.parse(null) || [
                    { id: 'T2001', name: 'John Smith', subject: 'Mathematics', classes: 'Grade 9-10', email: 'john.s@example.com', phone: '555-777-8888', fingerprintCredential: null }
                ];
                payrollEntries = JSON.parse(null) || [
                    { id: 'P001', period: 'March 2023', staffCount: 68, totalAmount: '85,240.00', status: 'Paid' }
                ];
                invoices = JSON.parse(null) || [
                    { id: 'I001', invoiceNumber: 'INV-2023-0042', date: 'Mar 15, 2023', amount: '1,250.00', status: 'Paid' }
                ];
                announcements = JSON.parse(null) || [
                    { id: 'A001', title: 'School Holiday', content: 'School will be closed on Nov 1st for holiday.', datePosted: '2023-10-20', status: 'Active' },
                    { id: 'A002', title: 'Parent-Teacher Meeting Reminder', content: 'Reminder: PTM on Oct 28th. Please check schedule.', datePosted: '2023-10-15', status: 'Archived' }
                ];
                notifications = JSON.parse(null) || [
                    { id: 1, title: "New student enrolled!", description: "Emily Johnson joined Grade 10.", time: "5 minutes ago", unread: true },
                    { id: 2, title: "Payroll processed", description: "March payroll completed for all staff.", time: "1 hour ago", unread: true },
                    { id: 3, title: "Event Reminder", description: "Parent-Teacher meeting tomorrow at 3 PM.", time: "Yesterday", unread: true },
                    { id: 4, title: "System Update", description: "System maintenance scheduled for Sunday.", time: "2 days ago", unread: false },
                ];
                auditLogs = JSON.parse(null) || [
                    { id: 'L001', timestamp: '2023-10-26 10:30:00', user: 'Admin User', action: 'Logged In', module: 'Authentication', details: 'Successful login from IP: 192.168.1.100' },
                    { id: 'L002', timestamp: '2023-10-26 10:35:15', user: 'Admin User', action: 'Added Student', module: 'Students', details: 'Added new student: Emily Johnson (ID: S1001)' },
                    { id: 'L003', timestamp: '2023-10-26 11:00:40', user: 'Jane Doe', action: 'Updated Grade', module: 'Students', details: 'Updated Math grade for John Smith to A-' }
                ];
                backups = JSON.parse(null) || [
                    { id: 'B001', backupId: 'BK20231026-001', date: '2023-10-26 02:00:00', size: '150 MB', type: 'Full' },
                    { id: 'B002', backupId: 'BK20231025-001', date: '2023-10-25 02:00:00', size: '148 MB', type: 'Full' }
                ];
                attendanceRecords = JSON.parse(null) || [
                    { id: 'ATT001', studentId: 'S1001', date: '2023-10-26', status: 'Present', remarks: '' },
                    { id: 'ATT002', studentId: 'S1002', date: '2023-10-26', status: 'Absent', remarks: 'Sick' },
                    { id: 'ATT003', studentId: 'S1003', date: '2023-10-26', status: 'Present', remarks: '' },
                    { id: 'ATT004', studentId: 'S1001', date: '2023-10-25', status: 'Present', remarks: '' },
                    { id: 'ATT005', studentId: 'S1002', date: '2023-10-25', status: 'Present', remarks: '' },
                    { id: 'ATT006', studentId: 'S1003', date: '2023-10-25', status: 'Leave', remarks: 'Family event' },
                ];
                teacherAttendanceRecords = JSON.parse(null) || [
                    { id: 'TATT001', teacherId: 'T2001', date: '2023-10-26', status: 'Present', remarks: '' },
                    { id: 'TATT002', teacherId: 'T2001', date: '2023-10-25', status: 'Present', remarks: '' },
                ];
            }

            function saveDataToLocalStorage() {
                );
                );
                );
                );
                );
                );
                );
                );
                );
                ); // New: Save attendance
                ); // New: Save teacher attendance
                updateDashboardStats(); // Update stats after data changes
            }

            function generateUniqueId(prefix) {
                return prefix + Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
            }

            function addAuditLog(user, action, module, details) {
                const newLog = {
                    id: generateUniqueId('L'),
                    timestamp: new Date().toLocaleString(),
                    user: user,
                    action: action,
                    module: module,
                    details: details
                };
                auditLogs.unshift(newLog); // Add to the beginning
                saveDataToLocalStorage();
                renderAuditLogs();
            }

            // --- Initial Data Load ---
            loadDataFromLocalStorage();

            const loginUi = document.getElementById('login-ui');
            const schoolSiteUi = document.getElementById('school-site-ui');

            // --- Login UI Elements ---
            const roleButtons = document.querySelectorAll('.role-button');
            const selectedRoleInput = document.getElementById('selectedRole');
            const loginForm = document.getElementById('loginForm');
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            const forgotPasswordModal = document.getElementById('forgotPasswordModal');
            const closeForgotPasswordModal = document.getElementById('closeForgotPasswordModal');
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');

            // --- School Site UI Elements ---
            const logoutButton = document.getElementById('logoutButton');
            const notificationButton = document.getElementById('notificationButton');
            const notificationDropdown = document.getElementById('notificationDropdown');
            const markAllReadBtn = document.getElementById('markAllReadBtn');
            const viewAllNotificationsLink = document.getElementById('viewAllNotificationsLink');
            const notificationList = document.getElementById("notificationList");
            const notificationCount = document.getElementById("notificationCount");
            const newCount = document.getElementById("newCount");
            const loggedInUserName = document.getElementById('loggedInUserName');
            const currentModuleTitle = document.getElementById('currentModuleTitle');


            const viewAllModal = document.getElementById("viewAllModal");
            const viewAllNotificationList = document.getElementById("viewAllNotificationList");
            const closeViewAllModal = document.getElementById("closeViewAllModal");
            const modalMarkAllReadBtn = document.getElementById("modalMarkAllReadBtn");

            const openPayrollModalBtn = document.getElementById('openPayrollModalBtn');
            const payrollModal = document.getElementById('payrollModal');
            const closePayrollModalBtn = document.getElementById('closePayrollModalBtn');
            const payrollForm = document.getElementById('payrollForm');
            const payrollTableBody = document.getElementById('payrollTableBody');

            const openAddInvoiceModalBtn = document.getElementById('openAddInvoiceModalBtn');
            const addInvoiceModal = document.getElementById('addInvoiceModal');
            const closeAddInvoiceModalBtn = document.getElementById('closeAddInvoiceModalBtn');
            const addInvoiceForm = document.getElementById('addInvoiceForm');
            const financeTableBody = document.getElementById('financeTableBody');

            const profileForm = document.getElementById('profileForm');
            const profilePictureInput = document.getElementById('profilePicture');
            const profilePicturePreview = document.getElementById('profilePicturePreview');
            const profileFullName = document.getElementById('fullName');
            const profileEmail = document.getElementById('email');
            const profileRole = document.getElementById('role');
            const profilePhone = document.getElementById('phone');
            const profileAddress = document.getElementById('address');


            const userProfileToggle = document.getElementById('userProfileToggle');
            const userDropdown = document.getElementById('userDropdown');

            const searchRollInput = document.getElementById('searchRoll');
            const searchClassSelect = document.getElementById('searchClass');
            const applySearchButton = document.getElementById('applySearch');
            const studentTableBody = document.getElementById('studentTableBody');

            const studentModal = document.getElementById('studentModal');
            const closeStudentModal = document.getElementById('closeStudentModal');
            const studentForm = document.getElementById('studentForm');
            const studentModalTitle = document.getElementById('studentModalTitle');
            const studentFormSubmitBtn = document.getElementById('studentFormSubmitBtn');


            const teacherModal = document.getElementById('teacherModal');
            const closeTeacherModal = document.getElementById('closeTeacherModal');
            const teacherForm = document.getElementById('teacherForm');
            const teacherTableBody = document.getElementById('teacherTableBody');
            const teacherModalTitle = document.getElementById('teacherModalTitle');
            const teacherFormSubmitBtn = document.getElementById('teacherFormSubmitBtn');


            const userModal = document.getElementById('userModal');
            const closeUserModal = document.getElementById('closeUserModal');
            const userForm = document.getElementById('userForm');
            const userTableBody = document.getElementById('userTableBody');
            const userModalTitle = document.getElementById('userModalTitle');
            const userFormSubmitBtn = document.getElementById('userFormSubmitBtn');


            const announcementModal = document.getElementById('announcementModal');
            const closeAnnouncementModal = document.getElementById('closeAnnouncementModal');
            const announcementForm = document.getElementById('announcementForm');
            const announcementTableBody = document.getElementById('announcementTableBody');
            const announcementModalTitle = document.getElementById('announcementModalTitle');
            const announcementFormSubmitBtn = document.getElementById('announcementFormSubmitBtn');


            const auditLogTableBody = document.getElementById('auditLogTableBody');
            const backupTableBody = document.getElementById('backupTableBody');
            const recentActivityList = document.getElementById('recentActivityList');

            // Dashboard Stats Elements
            const totalStudentsCount = document.getElementById('totalStudentsCount');
            const totalTeachersCount = document.getElementById('totalTeachersCount');
            const monthlyRevenue = document.getElementById('monthlyRevenue');
            const upcomingEventsCount = document.getElementById('upcomingEventsCount');

            // Chart.js instances
            let attendanceChartInstance = null;
            let performanceChartInstance = null;

            // New: Student Attendance Module Elements
            const attendanceModal = document.getElementById('attendanceModal');
            const closeAttendanceModal = document.getElementById('closeAttendanceModal');
            const attendanceForm = document.getElementById('attendanceForm');
            const attendanceModalTitle = document.getElementById('attendanceModalTitle');
            const attendanceFormSubmitBtn = document.getElementById('attendanceFormSubmitBtn');
            const attendanceStudentSelect = document.getElementById('attendanceStudentSelect');
            const attendanceTableBody = document.getElementById('attendanceTableBody');
            const attendanceClassFilter = document.getElementById('attendanceClassFilter');
            const attendanceDateFilter = document.getElementById('attendanceDateFilter');
            const attendanceStudentNameFilter = document.getElementById('attendanceStudentNameFilter');
            const applyAttendanceFilter = document.getElementById('applyAttendanceFilter');
            const attendanceTotalStudents = document.getElementById('attendanceTotalStudents');
            const attendanceTotalPresent = document.getElementById('attendanceTotalPresent');
            const attendanceTotalAbsent = document.getElementById('attendanceTotalAbsent');
            const registerStudentFingerprintBtn = document.getElementById('registerStudentFingerprintBtn');
            const verifyStudentFingerprintBtn = document.getElementById('verifyStudentFingerprintBtn');


            // New: Teacher Attendance Module Elements
            const teacherAttendanceModal = document.getElementById('teacherAttendanceModal');
            const closeTeacherAttendanceModal = document.getElementById('closeTeacherAttendanceModal');
            const teacherAttendanceForm = document.getElementById('teacherAttendanceForm');
            const teacherAttendanceModalTitle = document.getElementById('teacherAttendanceModalTitle');
            const teacherAttendanceFormSubmitBtn = document.getElementById('teacherAttendanceFormSubmitBtn');
            const teacherAttendanceTeacherSelect = document.getElementById('teacherAttendanceTeacherSelect');
            const teacherAttendanceTableBody = document.getElementById('teacherAttendanceTableBody');
            const teacherAttendanceSubjectFilter = document.getElementById('teacherAttendanceSubjectFilter');
            const teacherAttendanceDateFilter = document.getElementById('teacherAttendanceDateFilter');
            const teacherAttendanceNameFilter = document.getElementById('teacherAttendanceNameFilter');
            const applyTeacherAttendanceFilter = document.getElementById('applyTeacherAttendanceFilter');
            const teacherAttendanceTotalTeachers = document.getElementById('teacherAttendanceTotalTeachers');
            const teacherAttendanceTotalPresent = document.getElementById('teacherAttendanceTotalPresent');
            const teacherAttendanceTotalAbsent = document.getElementById('teacherAttendanceTotalAbsent');
            const registerTeacherFingerprintBtn = document.getElementById('registerTeacherFingerprintBtn');
            const verifyTeacherFingerprintBtn = document.getElementById('verifyTeacherFingerprintBtn');

            // NEW: Dark Mode Elements
            const darkModeToggle = document.getElementById('darkModeToggle');
            const darkModeIcon = darkModeToggle.querySelector('i');


            // --- Initial UI State Management ---
            function showLoginUi() {
                loginUi.style.display = 'flex'; // Use flex to center
                schoolSiteUi.style.display = 'none';
                document.body.style.justifyContent = 'center'; // Center login form
                document.body.style.alignItems = 'center';
                document.body.style.minHeight = '100vh';
                document.body.style.backgroundColor = 'var(--light)'; // Apply login background
                document.body.style.overflow = 'hidden'; // Prevent scrolling on login page
            }

            function showSchoolSiteUi() {
                loginUi.style.display = 'none';
                schoolSiteUi.style.display = 'flex'; // School site uses flex for sidebar/main content
                document.body.style.justifyContent = 'flex-start'; // Reset body alignment for school site
                document.body.style.alignItems = 'flex-start';
                document.body.style.minHeight = 'auto'; // Allow content to define height
                document.body.style.backgroundColor = 'var(--light)'; // Apply school site background
                document.body.style.overflow = 'auto'; // Allow scrolling on school site
                renderAllTables(); // Render all dynamic tables on login
                updateDashboardStats(); // Update stats after data changes
                renderRecentActivity(); // Render recent activity
                updateProfileForm(); // Populate profile form with logged in user data
                updateLoggedInUserName(); // Update user name in top bar
                // Re-initialize calendar if it was hidden
                if (typeof calendar !== 'undefined' && calendar) {
                    calendar.render();
                }
                // Render charts for reports module
                renderReportsCharts();
            }

            // Check login status on load
            if (null === 'true') {
                showSchoolSiteUi();
            } else {
                showLoginUi();
            }

            // --- Login UI Logic ---
            roleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    roleButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    selectedRoleInput.value = this.dataset.role;
                });
            });

            loginForm.addEventListener('submit', function(event) {
                event.preventDefault();

                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const role = selectedRoleInput.value;

                const user = users.find(u => u.name === username && u.password === password && u.role.toLowerCase() === role);

                if (user) {
                    alert('Login successful!');
                    
                    ); // Store logged in user info
                    showSchoolSiteUi();
                    addAuditLog(user.name, 'Logged In', 'Authentication', `Successful login for role: ${role}`);
                } else {
                    alert('Invalid username or password for ' + role + '.');
                    addAuditLog(username, 'Login Failed', 'Authentication', `Attempted login for role: ${role}`);
                }
            });

            // Forgot Password Modal Logic
            forgotPasswordLink.addEventListener('click', function(event) {
                event.preventDefault();
                forgotPasswordModal.classList.add('active');
            });

            closeForgotPasswordModal.addEventListener('click', function() {
                forgotPasswordModal.classList.remove('active');
                forgotPasswordForm.reset();
            });

            forgotPasswordModal.addEventListener('click', function(event) {
                if (event.target === forgotPasswordModal) {
                    forgotPasswordModal.classList.remove('active');
                    forgotPasswordForm.reset();
                }
            });

            forgotPasswordForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const email = document.getElementById('forgotEmail').value;
                if (email === '') {
                    alert('Please enter your email address.');
                    return;
                }
                alert('If an account with that email exists, a password reset link has been sent to ' + email + '.');
                forgotPasswordModal.classList.remove('active');
                forgotPasswordForm.reset();
            });

            // --- School Site UI Logic (adapted from original School Site.html) ---

            // Logout functionality
            if (logoutButton) {
                logoutButton.addEventListener('click', function() {
                    if (confirm('Are you sure you want to logout?')) {
                        const loggedInUser = JSON.parse(null);
                        addAuditLog(loggedInUser ? loggedInUser.name : 'Unknown', 'Logged Out', 'Authentication', 'User logged out');
                        localStorage.clear(); // Clear all local storage
                        showLoginUi(); // Show login UI
                        // Reset any active states or data in the school site UI if necessary
                        document.querySelectorAll('.module-content').forEach(m => m.classList.add('hidden'));
                        document.getElementById('dashboardMainContent').classList.remove('hidden');
                        document.getElementById('moduleTabs').classList.remove('hidden'); // Tabs should be visible on dashboard
                        document.getElementById('modulesContainer').classList.add('hidden');
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        document.querySelector('.nav-item[data-module="dashboard"]').classList.add('active');
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelector('.tab[data-tab="dashboard"]').classList.add('active');
                    }
                });
            }

            // Holiday Data
            const holidays = [
                { date: '2023-01-01', name: 'New Year\'s Day' },
                { date: '2023-01-16', name: 'Martin Luther King, Jr. Day' },
                { date: '2023-02-20', name: 'Presidents\' Day' },
                { date: '2023-03-17', name: 'St. Patrick\'s Day (Observed)' },
                { date: '2023-04-07', name: 'Good Friday' },
                { date: '2023-05-29', name: 'Memorial Day' },
                { date: '2023-06-19', name: 'Juneteenth' },
                { date: '2023-07-04', name: 'Independence Day' },
                { date: '2023-09-04', name: 'Labor Day' },
                { date: '2023-10-09', name: 'Columbus Day' },
                { date: '2023-11-10', name: 'Veterans Day (Observed)' },
                { date: '2023-11-23', name: 'Thanksgiving Day' },
                { date: '2023-12-25', name: 'Christmas Day' },
                { date: '2024-01-01', name: 'New Year\'s Day' },
                { date: '2024-01-15', name: 'Martin Luther King, Jr. Day' },
                { date: '2024-02-19', name: 'Presidents\' Day' },
                { date: '2024-03-29', name: 'Good Friday' },
                { date: '2024-05-27', name: 'Memorial Day' },
                { date: '2024-06-19', name: 'Juneteenth' },
                { date: '2024-07-04', name: 'Independence Day' },
                { date: '2024-09-02', name: 'Labor Day' },
                { date: '2024-10-14', name: 'Columbus Day' },
                { date: '2024-11-11', name: 'Veterans Day' },
                { date: '2024-11-28', name: 'Thanksgiving Day' },
                { date: '2024-12-25', name: 'Christmas Day' },
            ];

            // Initialize calendar
            var calendarEl = document.getElementById('calendar-full');
            var calendar; // Declare calendar variable globally or in a scope accessible by showSchoolSiteUi

            if (calendarEl) {
                calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    themeSystem: 'standard',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,listWeek'
                    },
                    editable: true,
                    selectable: true,
                    dayMaxEvents: true,
                    firstDay: 1, // Start week on Monday
                    eventColor: '#4F46E5', // Use primary color from new palette
                    eventTextColor: '#ffffff',
                    height: 'auto',
                    events: [
                        {
                            title: 'Parent-Teacher Meeting',
                            start: new Date().toISOString().split('T')[0],
                            backgroundColor: '#4F46E5',
                            borderColor: '#4F46E5'
                        },
                        {
                            title: 'Sports Day',
                            start: new Date(new Date().getTime() + 86400000 * 5).toISOString().split('T')[0],
                            backgroundColor: '#10B981',
                            borderColor: '#10B981'
                        },
                        {
                            title: 'End of Term Exams',
                            start: new Date(new Date().getTime() + 86400000 * 14).toISOString().split('T')[0],
                            end: new Date(new Date().getTime() + 86400000 * 18).toISOString().split('T')[0],
                            backgroundColor: '#F59E0B',
                            borderColor: '#F59E0B'
                        }
                    ],
                    eventSources: [
                        {
                            events: holidays.map(holiday => ({
                                title: holiday.name,
                                start: holiday.date,
                                allDay: true,
                                classNames: ['holiday'],
                                display: 'background'
                            }))
                        }
                    ],
                    eventDidMount: function(info) {
                        info.el.title = info.event.title;
                    }
                });
                // Only render if the school site UI is active
                if (null === 'true') {
                    calendar.render();
                }
            }

            const holidayListContainer = document.getElementById('holidayList');
            function renderHolidayList() {
                if (!holidayListContainer) return; // Ensure element exists
                holidayListContainer.innerHTML = '';
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                const upcomingHolidays = holidays
                    .filter(holiday => new Date(holiday.date) >= today)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));

                if (upcomingHolidays.length === 0) {
                    holidayListContainer.innerHTML = '<p class="text-gray-500 text-center py-4">No upcoming holidays.</p>';
                    return;
                }

                upcomingHolidays.slice(0, 5).forEach(holiday => {
                    const holidayDate = new Date(holiday.date);
                    const formattedDate = holidayDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const listItem = document.createElement('div');
                    listItem.className = 'holiday-list-item module-card';
                    listItem.innerHTML = `
                        <span class="date">${formattedDate}</span>
                        <span class="name">${holiday.name}</span>
                        <i class="fas fa-star text-red-500"></i>
                    `;
                    holidayListContainer.appendChild(listItem);
                });
            }
            renderHolidayList();

            window.showModule = function(moduleName) {
                const dashboardMainContent = document.getElementById('dashboardMainContent');
                const modulesContainer = document.getElementById('modulesContainer');
                const moduleTabs = document.getElementById('moduleTabs');

                // Update current module title in header
                currentModuleTitle.textContent = moduleName.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');

                // Hide all module content and dashboard
                document.querySelectorAll('.module-content').forEach(m => m.classList.add('hidden'));
                dashboardMainContent.classList.add('hidden');
                modulesContainer.classList.remove('hidden'); // Ensure container is visible for modules

                // Deactivate all tabs and nav items
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));

                if (moduleName === 'dashboard') {
                    dashboardMainContent.classList.remove('hidden');
                    modulesContainer.classList.add('hidden'); // Hide modules container for dashboard
                    moduleTabs.classList.remove('hidden'); // Show tabs on dashboard
                    document.querySelector('.tab[data-tab="dashboard"]').classList.add('active');
                    document.querySelector('.nav-item[data-module="dashboard"]').classList.add('active');
                    currentModuleTitle.textContent = 'Dashboard';
                } else {
                    const moduleElement = document.getElementById(`${moduleName}Module`);
                    if (moduleElement) {
                        moduleElement.classList.remove('hidden');
                    }
                    const tabElement = document.querySelector(`.tab[data-tab="${moduleName}"]`);
                    if (tabElement) {
                        tabElement.classList.add('active');
                    }
                    const activeNavItem = document.querySelector(`.nav-item[data-module="${moduleName}"]`);
                    if (activeNavItem) {
                        activeNavItem.classList.add('active');
                    }
                }
            }

            document.querySelectorAll('.open-module, .tab, .nav-item, .user-dropdown-item').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.preventDefault();
                    const moduleName = el.dataset.module || el.dataset.tab;
                    if (moduleName) {
                        showModule(moduleName);
                        // Close dropdowns if clicked from there
                        if (notificationDropdown) notificationDropdown.classList.remove('active');
                        if (userDropdown) userDropdown.classList.remove('active');
                    }
                });
            });

            function renderDropdownNotifications() {
                if (!notificationList || !notificationCount || !newCount) return;
                notificationList.innerHTML = "";
                let unreadCount = 0;
                // Display only the latest 3 notifications in the dropdown
                notifications.slice(0, 3).forEach((notif) => {
                    if (notif.unread) unreadCount++;
                    const div = document.createElement("div");
                    div.className = "notification-item" + (notif.unread ? " unread" : "");
                    div.dataset.id = notif.id;
                    div.innerHTML = `
                        <div class="title">${notif.title}</div>
                        <p class="text-sm text-gray-600">${notif.description}</p>
                        <div class="time">${notif.time}</div>
                    `;
                    div.addEventListener("click", () => {
                        markNotificationRead(notif.id);
                        // alert(`Notification clicked: ${notif.title}`); // Removed for smoother UX
                    });
                    notificationList.appendChild(div);
                });
                notificationCount.textContent = unreadCount > 0 ? unreadCount : "";
                newCount.textContent = unreadCount > 0 ? `${unreadCount} New` : "No new";
                saveDataToLocalStorage();
            }

            function renderModalNotifications() {
                if (!viewAllNotificationList) return;
                viewAllNotificationList.innerHTML = "";
                notifications.forEach((notif) => {
                    const div = document.createElement("div");
                    div.className = "view-all-notification" + (notif.unread ? " unread" : "");
                    div.dataset.id = notif.id;
                    div.innerHTML = `
                        <div class="title">${notif.title}</div>
                        <p class="text-sm text-gray-600">${notif.description}</p>
                        <div class="time">${notif.time}</div>
                    `;
                    div.addEventListener("click", () => {
                        markNotificationRead(notif.id);
                        div.classList.remove("unread");
                        // alert(`Notification clicked: ${notif.title}`); // Removed for smoother UX
                    });
                    viewAllNotificationList.appendChild(div);
                });
                saveDataToLocalStorage();
            }

            function markNotificationRead(id) {
                const notif = notifications.find((n) => n.id === id);
                if (notif && notif.unread) {
                    notif.unread = false;
                    renderDropdownNotifications();
                    renderModalNotifications();
                    addAuditLog(JSON.parse(null)?.name || 'System', 'Notification Read', 'Notifications', `Notification "${notif.title}" marked as read.`);
                }
            }

            function markAllAsRead() {
                notifications.forEach((n) => (n.unread = false));
                renderDropdownNotifications();
                renderModalNotifications();
                addAuditLog(JSON.parse(null)?.name || 'System', 'Notifications', 'Notifications', 'All notifications marked as read.');
            }

            if (notificationButton) {
                notificationButton.addEventListener('click', function(event) {
                    event.stopPropagation();
                    notificationDropdown.classList.toggle('active');
                    if (userDropdown) userDropdown.classList.remove('active');
                });
            }

            document.addEventListener('click', function(event) {
                if (notificationDropdown && !notificationDropdown.contains(event.target) && (!notificationButton || !notificationButton.contains(event.target))) {
                    notificationDropdown.classList.remove('active');
                }
            });

            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', function() {
                    markAllAsRead();
                    // alert('All notifications marked as read!'); // Removed for smoother UX
                });
            }

            if (viewAllNotificationsLink) {
                viewAllNotificationsLink.addEventListener('click', function(event) {
                    event.preventDefault();
                    if (notificationDropdown) notificationDropdown.classList.remove("active");
                    if (viewAllModal) viewAllModal.classList.add("active");
                    renderModalNotifications();
                });
            }

            if (closeViewAllModal) {
                closeViewAllModal.addEventListener("click", () => {
                    if (viewAllModal) viewAllModal.classList.remove("active");
                });
            }

            if (viewAllModal) {
                viewAllModal.addEventListener("click", (e) => {
                    if (e.target === viewAllModal) {
                        viewAllModal.classList.remove("active");
                    }
                });
            }

            if (modalMarkAllReadBtn) {
                modalMarkAllReadBtn.addEventListener("click", () => {
                    markAllAsRead();
                    // alert("All notifications marked as read!"); // Removed for smoother UX
                });
            }

            // Payroll Module Specific JavaScript
            function renderPayrollTable() {
                if (!payrollTableBody) return;
                payrollTableBody.innerHTML = '';
                if (payrollEntries.length === 0) {
                    payrollTableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No payroll entries found.</td></tr>';
                    return;
                }
                payrollEntries.forEach(entry => {
                    const newRow = document.createElement('tr');
                    newRow.className = 'border-b hover:bg-gray-50';
                    let statusBgClass = '';
                    let statusTextColorClass = '';
                    switch (entry.status) {
                        case 'Paid': statusBgClass = 'bg-green-100'; statusTextColorClass = 'text-green-800'; break;
                        case 'Processing': statusBgClass = 'bg-yellow-100'; statusTextColorClass = 'text-yellow-800'; break;
                        case 'Pending': statusBgClass = 'bg-blue-100'; statusTextColorClass = 'text-blue-800'; break;
                    }
                    newRow.innerHTML = `
                        <td class="py-3 px-4">${entry.period}</td>
                        <td class="py-3 px-4">${entry.staffCount}</td>
                        <td class="py-3 px-4">$${parseFloat(entry.totalAmount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 ${statusBgClass} ${statusTextColorClass} text-xs rounded-full">${entry.status}</span>
                        </td>
                        <td class="py-3 px-4">
                            <button class="text-blue-600 hover:text-blue-800 mr-3" title="View Details" onclick="alert('Viewing details for payroll ${entry.period}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800" title="Download PDF" onclick="alert('Downloading PDF for payroll ${entry.period}')">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                        </td>
                    `;
                    payrollTableBody.prepend(newRow); // Add to the top
                });
            }

            if (openPayrollModalBtn) {
                openPayrollModalBtn.addEventListener('click', () => {
                    if (payrollModal) payrollModal.classList.remove('hidden');
                });
            }

            if (closePayrollModalBtn) {
                closePayrollModalBtn.addEventListener('click', () => {
                    if (payrollModal) payrollModal.classList.add('hidden');
                    if (payrollForm) payrollForm.reset();
                });
            }

            if (payrollModal) {
                payrollModal.addEventListener('click', (e) => {
                    if (e.target === payrollModal) {
                        payrollModal.classList.add('hidden');
                        if (payrollForm) payrollForm.reset();
                    }
                });
            }

            if (payrollForm) {
                payrollForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const periodInput = document.getElementById('payrollPeriod').value;
                    const staffCount = document.getElementById('staffCount').value;
                    const totalAmount = parseFloat(document.getElementById('totalAmount').value).toFixed(2);

                    if (!periodInput || !staffCount || !totalAmount) {
                        alert('Please fill in all fields.');
                        return;
                    }

                    const [year, monthNum] = periodInput.split('-');
                    const date = new Date(year, monthNum - 1);
                    const formattedPeriod = date.toLocaleString('default', { month: 'long', year: 'numeric' });

                    const newPayrollEntry = {
                        id: generateUniqueId('P'),
                        period: formattedPeriod,
                        staffCount: parseInt(staffCount),
                        totalAmount: totalAmount,
                        status: 'Processing'
                    };
                    payrollEntries.push(newPayrollEntry);
                    saveDataToLocalStorage();
                    renderPayrollTable();

                    alert('Payroll processing initiated successfully!');
                    addAuditLog(JSON.parse(null)?.name || 'Admin', 'Processed Payroll', 'Payroll', `Processed payroll for ${formattedPeriod}, amount: $${totalAmount}`);
                    if (payrollModal) payrollModal.classList.add('hidden');
                    payrollForm.reset();
                });
            }

            // Finance Module Specific JavaScript
            function renderFinanceTable() {
                if (!financeTableBody) return;
                financeTableBody.innerHTML = '';
                if (invoices.length === 0) {
                    financeTableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No invoices found.</td></tr>';
                    return;
                }
                invoices.forEach(invoice => {
                    const newRow = document.createElement('tr');
                    newRow.className = 'border-b hover:bg-gray-50';
                    let statusBgClass = '';
                    let statusTextColorClass = '';
                    switch (invoice.status) {
                        case 'Paid': statusBgClass = 'bg-blue-100'; statusTextColorClass = 'text-blue-800'; break;
                        case 'Pending': statusBgClass = 'bg-yellow-100'; statusTextColorClass = 'text-yellow-800'; break;
                        case 'Overdue': statusBgClass = 'bg-red-100'; statusTextColorClass = 'text-red-800'; break;
                    }
                    newRow.innerHTML = `
                        <td class="py-3 px-4">${invoice.invoiceNumber}</td>
                        <td class="py-3 px-4">${invoice.date}</td>
                        <td class="py-3 px-4">$${parseFloat(invoice.amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 ${statusBgClass} ${statusTextColorClass} text-xs rounded-full">${invoice.status}</span>
                        </td>
                        <td class="py-3 px-4">
                            <button class="text-blue-600 hover:text-blue-800 mr-3" title="View Details" onclick="alert('Viewing details for invoice ${invoice.invoiceNumber}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800" title="Download PDF" onclick="alert('Downloading PDF for invoice ${invoice.invoiceNumber}')">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                        </td>
                    `;
                    financeTableBody.prepend(newRow); // Add to the top
                });
            }

            if (openAddInvoiceModalBtn) {
                openAddInvoiceModalBtn.addEventListener('click', () => {
                    if (addInvoiceModal) addInvoiceModal.classList.remove('hidden');
                });
            }

            if (closeAddInvoiceModalBtn) {
                closeAddInvoiceModalBtn.addEventListener('click', () => {
                    if (addInvoiceModal) addInvoiceModal.classList.add('hidden');
                    if (addInvoiceForm) addInvoiceForm.reset();
                });
            }

            if (addInvoiceModal) {
                addInvoiceModal.addEventListener('click', (e) => {
                    if (e.target === addInvoiceModal) {
                        addInvoiceModal.classList.add('hidden');
                        if (addInvoiceForm) addInvoiceForm.reset();
                    }
                });
            }

            if (addInvoiceForm) {
                addInvoiceForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const invoiceNumber = document.getElementById('invoiceNumber').value;
                    const invoiceDateInput = document.getElementById('invoiceDate').value;
                    const invoiceAmount = parseFloat(document.getElementById('invoiceAmount').value).toFixed(2);
                    const invoiceStatus = document.getElementById('invoiceStatus').value;

                    if (!invoiceNumber || !invoiceDateInput || !invoiceAmount || !invoiceStatus) {
                        alert('Please fill in all fields.');
                        return;
                    }

                    const dateParts = invoiceDateInput.split('-');
                    const dateObj = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                    const formattedDate = dateObj.toLocaleString('default', { month: 'short', day: 'numeric', year: 'numeric' });

                    const newInvoice = {
                        id: generateUniqueId('I'),
                        invoiceNumber: invoiceNumber,
                        date: formattedDate,
                        amount: invoiceAmount,
                        status: invoiceStatus
                    };
                    invoices.push(newInvoice);
                    saveDataToLocalStorage();
                    renderFinanceTable();

                    alert('Invoice added successfully!');
                    addAuditLog(JSON.parse(null)?.name || 'Admin', 'Added Invoice', 'Finance', `Added invoice ${invoiceNumber} for $${invoiceAmount}`);
                    if (addInvoiceModal) addInvoiceModal.classList.add('hidden');
                    addInvoiceForm.reset();
                });
            }

            // Profile Module Specific JavaScript
            function updateProfileForm() {
                const loggedInUser = JSON.parse(null);
                if (loggedInUser) {
                    profileFullName.value = loggedInUser.name || '';
                    profileEmail.value = loggedInUser.email || '';
                    profileRole.value = loggedInUser.role || '';
                    // These fields are not in initial user data, so they'll be empty or default
                    profilePhone.value = '+123 456 7890'; // Placeholder
                    profileAddress.value = '123 School Lane, Education City'; // Placeholder
                }
            }

            function updateLoggedInUserName() {
                const loggedInUser = JSON.parse(null);
                if (loggedInUser && loggedInUserName) {
                    loggedInUserName.textContent = loggedInUser.name;
                }
            }

            if (profileForm) {
                profileForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const loggedInUser = JSON.parse(null);
                    if (loggedInUser) {
                        loggedInUser.name = profileFullName.value;
                        loggedInUser.email = profileEmail.value;
                        loggedInUser.role = profileRole.value;
                        // In a real app, you'd save phone and address too
                        );
                        saveDataToLocalStorage(); // To trigger dashboard stats update if needed
                        updateLoggedInUserName();
                        alert('Profile changes saved successfully!');
                        addAuditLog(loggedInUser.name, 'Updated Profile', 'Profile', 'User profile updated.');
                    }
                });
            }

            if (profilePictureInput) {
                profilePictureInput.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            if (profilePicturePreview) profilePicturePreview.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // User Dropdown Functionality
            if (userProfileToggle) {
                userProfileToggle.addEventListener('click', function(event) {
                    event.stopPropagation();
                    if (userDropdown) userDropdown.classList.toggle('active');
                    if (notificationDropdown) notificationDropdown.classList.remove('active');
                });
            }

            document.addEventListener('click', function(event) {
                if (userDropdown && !userDropdown.contains(event.target) && (!userProfileToggle || !userProfileToggle.contains(event.target))) {
                    userDropdown.classList.remove('active');
                }
            });

            // Student Search and Render Functionality
            function renderStudentTable(filteredStudents = students) {
                if (!studentTableBody) return;
                studentTableBody.innerHTML = '';
                if (filteredStudents.length === 0) {
                    studentTableBody.innerHTML = '<tr><td colspan="9" class="text-center py-4 text-gray-500">No students found matching your criteria.</td></tr>';
                    return;
                }
                filteredStudents.forEach(student => {
                    const newRow = document.createElement('tr');
                    newRow.className = 'border-b hover:bg-gray-50';
                    let statusBgClass = '';
                    let statusTextColorClass = '';
                    switch (student.status) {
                        case 'Active': statusBgClass = 'bg-green-100'; statusTextColorClass = 'text-green-800'; break;
                        case 'Inactive': statusBgClass = 'bg-yellow-100'; statusTextColorClass = 'text-yellow-800'; break;
                    }
                    newRow.innerHTML = `
                        <td class="py-3 px-4">${student.id}</td>
                        <td class="py-3 px-4">${student.name}</td>
                        <td class="py-3 px-4">${student.fatherName}</td>
                        <td class="py-3 px-4">${student.motherName}</td>
                        <td class="py-3 px-4">${student.class}</td>
                        <td class="py-3 px-4">${student.rollNo}</td>
                        <td class="py-3 px-4">${student.aadharNo}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 ${statusBgClass} ${statusTextColorClass} text-xs rounded-full">${student.status}</span>
                        </td>
                        <td class="py-3 px-4 table-actions">
                            <button class="text-blue-600 mr-3" title="Edit Student" onclick="editStudent('${student.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600" title="Delete Student" onclick="deleteStudent('${student.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    studentTableBody.appendChild(newRow);
                });
            }

            function filterStudents() {
                const rollQuery = searchRollInput.value.toLowerCase();
                const classQuery = searchClassSelect.value.toLowerCase();

                const filtered = students.filter(student => {
                    const rollMatch = student.rollNo.toLowerCase().includes(rollQuery);
                    const classMatch = classQuery === '' || student.class.toLowerCase() === classQuery;
                    return rollMatch && classMatch;
                });
                renderStudentTable(filtered);
            }

            if (applySearchButton) applySearchButton.addEventListener('click', filterStudents);
            if (searchRollInput) searchRollInput.addEventListener('keyup', filterStudents);
            if (searchClassSelect) searchClassSelect.addEventListener('change', filterStudents);

            // Teacher Render Functionality
            function renderTeacherTable() {
                if (!teacherTableBody) return;
                teacherTableBody.innerHTML = '';
                if (teachers.length === 0) {
                    teacherTableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No teachers found.</td></tr>';
                    return;
                }
                teachers.forEach(teacher => {
                    const newRow = document.createElement('tr');
                    newRow.className = 'border-b hover:bg-gray-50';
                    newRow.innerHTML = `
                        <td class="py-3 px-4">${teacher.id}</td>
                        <td class="py-3 px-4">${teacher.name}</td>
                        <td class="py-3 px-4">${teacher.subject}</td>
                        <td class="py-3 px-4">${teacher.classes}</td>
                        <td class="py-3 px-4 table-actions">
                            <button class="text-blue-600 mr-3" title="Edit Teacher" onclick="editTeacher('${teacher.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600" title="Delete Teacher" onclick="deleteTeacher('${teacher.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    teacherTableBody.appendChild(newRow);
                });
            }

            // User Render Functionality
            function renderUserTable() {
                if (!userTableBody) return;
                userTableBody.innerHTML = '';
                if (users.length === 0) {
                    userTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-gray-500">No users found.</td></tr>';
                    return;
                }
                users.forEach(user => {
                    const newRow = document.createElement('tr');
                    newRow.className = 'border-b hover:bg-gray-50';
                    let statusBgClass = '';
                    let statusTextColorClass = '';
                    switch (user.status) {
                        case 'Active': statusBgClass = 'bg-green-100'; statusTextColorClass = 'text-green-800'; break;
                        case 'Inactive': statusBgClass = 'bg-yellow-100'; statusTextColorClass = 'text-yellow-800'; break;
                    }
                    newRow.innerHTML = `
                        <td class="py-3 px-4">${user.id}</td>
                        <td class="py-3 px-4">${user.name}</td>
                        <td class="py-3 px-4">${user.email}</td>
                        <td class="py-3 px-4">${user.role}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 ${statusBgClass} ${statusTextColorClass} text-xs rounded-full">${user.status}</span>
                        </td>
                        <td class="py-3 px-4 table-actions">
                            <button class="text-blue-600 mr-3" title="Edit User" onclick="editUser('${user.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600" title="Delete User" onclick="deleteUser('${user.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    userTableBody.appendChild(newRow);
                });
            }

            // Announcement Render Functionality
            function renderAnnouncementTable() {
                if (!announcementTableBody) return;
                announcementTableBody.innerHTML = '';
                if (announcements.length === 0) {
                    announcementTableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No announcements found.</td></tr>';
                    return;
                }
                announcements.forEach(announcement => {
                    const newRow = document.createElement('tr');
                    newRow.className = 'border-b hover:bg-gray-50';
                    let statusBgClass = '';
                    let statusTextColorClass = '';
                    switch (announcement.status) {
                        case 'Active': statusBgClass = 'bg-green-100'; statusTextColorClass = 'text-green-800'; break;
                        case 'Archived': statusBgClass = 'bg-yellow-100'; statusTextColorClass = 'text-yellow-800'; break;
                    }
                    newRow.innerHTML = `
                        <td class="py-3 px-4">${announcement.title}</td>
                        <td class="py-3 px-4">${announcement.content.substring(0, 50)}${announcement.content.length > 50 ? '...' : ''}</td>
                        <td class="py-3 px-4">${announcement.datePosted}</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 ${statusBgClass} ${statusTextColorClass} text-xs rounded-full">${announcement.status}</span>
                        </td>
                        <td class="py-3 px-4 table-actions">
                            <button class="text-blue-600 mr-3" title="Edit Announcement" onclick="editAnnouncement('${announcement.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600" title="Delete Announcement" onclick="deleteAnnouncement('${announcement.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    announcementTableBody.appendChild(newRow);
                });
            }

            // Audit Log Render Functionality
            function renderAuditLogs() {
                if (!auditLogTableBody) return;
                auditLogTableBody.innerHTML = '';
                if (auditLogs.length === 0) {
                    auditLogTableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No audit logs found.</td></tr>';
                    return;
                }
                auditLogs.forEach(log => {
                    const newRow = document.createElement('tr');
                    newRow.className = 'border-b hover:bg-gray-50';
                    newRow.innerHTML = `
                        <td class="py-3 px-4">${log.timestamp}</td>
                        <td class="py-3 px-4">${log.user}</td>
                        <td class="py-3 px-4">${log.action}</td>
                        <td class="py-3 px-4">${log.module}</td>
                        <td class="py-3 px-4">${log.details}</td>
                    `;
                    auditLogTableBody.appendChild(newRow);
                });
            }

            // Backup Render Functionality
            function renderBackupTable() {
                if (!backupTableBody) return;
                backupTableBody.innerHTML = '';
                if (backups.length === 0) {
                    backupTableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No backups found.</td></tr>';
                    return;
                }
                backups.forEach(backup => {
                    const newRow = document.createElement('tr');
                    newRow.className = 'border-b hover:bg-gray-50';
                    newRow.innerHTML = `
                        <td class="py-3 px-4">${backup.backupId}</td>
                        <td class="py-3 px-4">${backup.date}</td>
                        <td class="py-3 px-4">${backup.size}</td>
                        <td class="py-3 px-4">${backup.type}</td>
                        <td class="py-3 px-4 table-actions">
                            <button class="text-blue-600 mr-3" title="Download Backup" onclick="alert('Downloading backup ${backup.backupId}...')">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="text-green-600 mr-3" title="Restore from this Backup" onclick="alert('Restoring from backup ${backup.backupId}...')">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="text-red-600" title="Delete Backup" onclick="alert('Deleting backup ${backup.backupId}...')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    backupTableBody.appendChild(newRow);
                });
            }

            // New: Student Attendance Module Functions
            function renderAttendanceTable(filteredAttendance = attendanceRecords) {
                if (!attendanceTableBody) return;
                attendanceTableBody.innerHTML = '';

                let totalPresent = 0;
                let totalAbsent = 0;
                let uniqueStudents = new Set();

                if (filteredAttendance.length === 0) {
                    attendanceTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-500">No attendance records found for the selected criteria.</td></tr>';
                } else {
                    filteredAttendance.forEach(record => {
                        const student = students.find(s => s.id === record.studentId);
                        if (!student) return; // Skip if student not found

                        uniqueStudents.add(student.id);

                        if (record.status === 'Present') {
                            totalPresent++;
                        } else if (record.status === 'Absent') {
                            totalAbsent++;
                        }

                        const newRow = document.createElement('tr');
                        newRow.className = 'border-b hover:bg-gray-50';
                        let statusBgClass = '';
                        let statusTextColorClass = '';
                        switch (record.status) {
                            case 'Present': statusBgClass = 'bg-green-100'; statusTextColorClass = 'text-green-800'; break;
                            case 'Absent': statusBgClass = 'bg-red-100'; statusTextColorClass = 'text-red-800'; break;
                            case 'Leave': statusBgClass = 'bg-yellow-100'; statusTextColorClass = 'text-yellow-800'; break;
                        }
                        newRow.innerHTML = `
                            <td class="py-3 px-4">${student.name}</td>
                            <td class="py-3 px-4">${student.rollNo}</td>
                            <td class="py-3 px-4">${student.class}</td>
                            <td class="py-3 px-4">${record.date}</td>
                            <td class="py-3 px-4">
                                <span class="px-2 py-1 ${statusBgClass} ${statusTextColorClass} text-xs rounded-full">${record.status}</span>
                            </td>
                            <td class="py-3 px-4">${record.remarks || '-'}</td>
                            <td class="py-3 px-4 table-actions">
                                <button class="text-blue-600 mr-3" title="Edit Attendance" onclick="editAttendance('${record.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="text-red-600" title="Delete Attendance" onclick="deleteAttendance('${record.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        attendanceTableBody.appendChild(newRow);
                    });
                }

                if (attendanceTotalStudents) attendanceTotalStudents.textContent = uniqueStudents.size;
                if (attendanceTotalPresent) attendanceTotalPresent.textContent = totalPresent;
                if (attendanceTotalAbsent) attendanceTotalAbsent.textContent = totalAbsent;
            }

            function filterAttendance() {
                const classFilter = attendanceClassFilter.value.toLowerCase();
                const dateFilter = attendanceDateFilter.value; // YYYY-MM-DD format
                const studentNameFilter = attendanceStudentNameFilter.value.toLowerCase();

                const filtered = attendanceRecords.filter(record => {
                    const student = students.find(s => s.id === record.studentId);
                    if (!student) return false;

                    const classMatch = classFilter === '' || student.class.toLowerCase() === classFilter;
                    const dateMatch = dateFilter === '' || record.date === dateFilter;
                    const nameMatch = studentNameFilter === '' || student.name.toLowerCase().includes(studentNameFilter);

                    return classMatch && dateMatch && nameMatch;
                });
                renderAttendanceTable(filtered);
            }

            if (applyAttendanceFilter) applyAttendanceFilter.addEventListener('click', filterAttendance);
            if (attendanceClassFilter) attendanceClassFilter.addEventListener('change', filterAttendance);
            if (attendanceDateFilter) attendanceDateFilter.addEventListener('change', filterAttendance);
            if (attendanceStudentNameFilter) attendanceStudentNameFilter.addEventListener('keyup', filterAttendance);

            // New: Teacher Attendance Module Functions
            function renderTeacherAttendanceTable(filteredRecords = teacherAttendanceRecords) {
                if (!teacherAttendanceTableBody) return;
                teacherAttendanceTableBody.innerHTML = '';

                let totalPresent = 0;
                let totalAbsent = 0;
                let uniqueTeachers = new Set();

                if (filteredRecords.length === 0) {
                    teacherAttendanceTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-gray-500">No teacher attendance records found for the selected criteria.</td></tr>';
                } else {
                    filteredRecords.forEach(record => {
                        const teacher = teachers.find(t => t.id === record.teacherId);
                        if (!teacher) return; // Skip if teacher not found

                        uniqueTeachers.add(teacher.id);

                        if (record.status === 'Present') {
                            totalPresent++;
                        } else if (record.status === 'Absent') {
                            totalAbsent++;
                        }

                        const newRow = document.createElement('tr');
                        newRow.className = 'border-b hover:bg-gray-50';
                        let statusBgClass = '';
                        let statusTextColorClass = '';
                        switch (record.status) {
                            case 'Present': statusBgClass = 'bg-green-100'; statusTextColorClass = 'text-green-800'; break;
                            case 'Absent': statusBgClass = 'bg-red-100'; statusTextColorClass = 'text-red-800'; break;
                            case 'Leave': statusBgClass = 'bg-yellow-100'; statusTextColorClass = 'text-yellow-800'; break;
                        }
                        newRow.innerHTML = `
                            <td class="py-3 px-4">${teacher.name}</td>
                            <td class="py-3 px-4">${teacher.subject}</td>
                            <td class="py-3 px-4">${record.date}</td>
                            <td class="py-3 px-4">
                                <span class="px-2 py-1 ${statusBgClass} ${statusTextColorClass} text-xs rounded-full">${record.status}</span>
                            </td>
                            <td class="py-3 px-4">${record.remarks || '-'}</td>
                            <td class="py-3 px-4 table-actions">
                                <button class="text-blue-600 mr-3" title="Edit Attendance" onclick="editTeacherAttendance('${record.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="text-red-600" title="Delete Attendance" onclick="deleteTeacherAttendance('${record.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        teacherAttendanceTableBody.appendChild(newRow);
                    });
                }

                if (teacherAttendanceTotalTeachers) teacherAttendanceTotalTeachers.textContent = uniqueTeachers.size;
                if (teacherAttendanceTotalPresent) teacherAttendanceTotalPresent.textContent = totalPresent;
                if (teacherAttendanceTotalAbsent) teacherAttendanceTotalAbsent.textContent = totalAbsent;
            }

            function filterTeacherAttendance() {
                const subjectFilter = teacherAttendanceSubjectFilter.value.toLowerCase();
                const dateFilter = teacherAttendanceDateFilter.value; // YYYY-MM-DD format
                const nameFilter = teacherAttendanceNameFilter.value.toLowerCase();

                const filtered = teacherAttendanceRecords.filter(record => {
                    const teacher = teachers.find(t => t.id === record.teacherId);
                    if (!teacher) return false;

                    const subjectMatch = subjectFilter === '' || teacher.subject.toLowerCase() === subjectFilter;
                    const dateMatch = dateFilter === '' || record.date === dateFilter;
                    const nameMatch = nameFilter === '' || teacher.name.toLowerCase().includes(nameFilter);

                    return subjectMatch && dateMatch && nameMatch;
                });
                renderTeacherAttendanceTable(filtered);
            }

            if (applyTeacherAttendanceFilter) applyTeacherAttendanceFilter.addEventListener('click', filterTeacherAttendance);
            if (teacherAttendanceSubjectFilter) teacherAttendanceSubjectFilter.addEventListener('change', filterTeacherAttendance);
            if (teacherAttendanceDateFilter) teacherAttendanceDateFilter.addEventListener('change', filterTeacherAttendance);
            if (teacherAttendanceNameFilter) teacherAttendanceNameFilter.addEventListener('keyup', filterTeacherAttendance);

            window.showAddTeacherAttendanceModal = function() {
                teacherAttendanceModalTitle.textContent = 'Mark Teacher Attendance';
                teacherAttendanceFormSubmitBtn.textContent = 'Mark Attendance';
                document.getElementById('teacherAttendanceId').value = '';
                teacherAttendanceForm.reset();
                populateTeacherSelect();
                document.getElementById('teacherAttendanceDate').valueAsDate = new Date(); // Set default date to today
                if (teacherAttendanceModal) teacherAttendanceModal.classList.remove('hidden');
            }

            window.editTeacherAttendance = function(id) {
                const record = teacherAttendanceRecords.find(r => r.id === id);
                if (record) {
                    teacherAttendanceModalTitle.textContent = 'Edit Teacher Attendance';
                    teacherAttendanceFormSubmitBtn.textContent = 'Save Changes';
                    document.getElementById('teacherAttendanceId').value = record.id;
                    populateTeacherSelect(record.teacherId); // Select the teacher
                    document.getElementById('teacherAttendanceDate').value = record.date;
                    document.getElementById('teacherAttendanceStatus').value = record.status;
                    document.getElementById('teacherAttendanceRemarks').value = record.remarks;
                    if (teacherAttendanceModal) teacherAttendanceModal.classList.remove('hidden');
                }
            }

            window.deleteTeacherAttendance = function(id) {
                if (confirm('Are you sure you want to delete this teacher attendance record?')) {
                    const recordIndex = teacherAttendanceRecords.findIndex(r => r.id === id);
                    if (recordIndex > -1) {
                        const deletedRecord = teacherAttendanceRecords.splice(recordIndex, 1)[0];
                        const teacher = teachers.find(s => s.id === deletedRecord.teacherId);
                        saveDataToLocalStorage();
                        renderTeacherAttendanceTable();
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Deleted Teacher Attendance', 'Teacher Attendance', `Deleted attendance for ${teacher ? teacher.name : 'Unknown Teacher'} on ${deletedRecord.date}`);
                        alert('Teacher attendance record deleted successfully!');
                    }
                }
            }

            function populateTeacherSelect(selectedTeacherId = '') {
                if (!teacherAttendanceTeacherSelect) return;
                teacherAttendanceTeacherSelect.innerHTML = '<option value="">Select Teacher</option>';
                teachers.forEach(teacher => {
                    const option = document.createElement('option');
                    option.value = teacher.id;
                    option.textContent = `${teacher.name} (Subject: ${teacher.subject})`;
                    if (teacher.id === selectedTeacherId) {
                        option.selected = true;
                    }
                    teacherAttendanceTeacherSelect.appendChild(option);
                });
            }


            // Render all dynamic tables
            function renderAllTables() {
                renderStudentTable();
                renderTeacherTable();
                renderUserTable();
                renderPayrollTable();
                renderFinanceTable();
                renderAnnouncementTable();
                renderAuditLogs();
                renderBackupTable();
                renderDropdownNotifications();
                renderModalNotifications();
                renderAttendanceTable(); // New: Render student attendance
                renderTeacherAttendanceTable(); // New: Render teacher attendance
            }

            // Update Dashboard Stats
            function updateDashboardStats() {
                if (totalStudentsCount) totalStudentsCount.textContent = students.length.toLocaleString();
                if (totalTeachersCount) totalTeachersCount.textContent = teachers.length.toLocaleString();
                
                // For monthly revenue, sum up paid invoices for the current month
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                const currentMonthRevenue = invoices.filter(inv => {
                    const invDate = new Date(inv.date);
                    return inv.status === 'Paid' && invDate.getMonth() === currentMonth && invDate.getFullYear() === currentYear;
                }).reduce((sum, inv) => sum + parseFloat(inv.amount), 0);
                if (monthlyRevenue) monthlyRevenue.textContent = `$${currentMonthRevenue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                
                // For upcoming events, count events from FullCalendar
                if (upcomingEventsCount && calendar) {
                    const today = new Date();
                    today.setHours(0,0,0,0);
                    const upcomingEvents = calendar.getEvents().filter(event => {
                        // Filter out holidays that are already past
                        if (event.classNames.includes('holiday')) {
                            return new Date(event.start) >= today;
                        }
                        // For other events, check if they are in the future or ongoing
                        return event.end ? new Date(event.end) >= today : new Date(event.start) >= today;
                    });
                    upcomingEventsCount.textContent = upcomingEvents.length.toLocaleString();
                } else if (upcomingEventsCount) {
                    upcomingEventsCount.textContent = 'N/A'; // Fallback if calendar not initialized
                }
            }

            // Render Recent Activity
            function renderRecentActivity() {
                if (!recentActivityList) return;
                recentActivityList.innerHTML = '';
                // Take the latest 3 audit logs as recent activity
                auditLogs.slice(0, 3).forEach(log => {
                    const div = document.createElement('div');
                    div.className = 'flex items-start space-x-3 animate-slideInFromLeft';
                    let iconClass = 'fas fa-info-circle';
                    let iconBgClass = 'bg-gray-50';
                    let iconTextColorClass = 'text-gray-600';

                    if (log.action.includes('Added Student')) { iconClass = 'fas fa-user-plus'; iconBgClass = 'bg-blue-50'; iconTextColorClass = 'text-blue-600'; }
                    else if (log.action.includes('Processed Payroll')) { iconClass = 'fas fa-money-bill-wave'; iconBgClass = 'bg-green-50'; iconTextColorClass = 'text-green-600'; }
                    else if (log.action.includes('Added Invoice')) { iconClass = 'fas fa-file-invoice-dollar'; iconBgClass = 'bg-purple-50'; iconTextColorClass = 'text-purple-600'; }
                    else if (log.action.includes('Logged In')) { iconClass = 'fas fa-sign-in-alt'; iconBgClass = 'bg-indigo-50'; iconTextColorClass = 'text-indigo-600'; }
                    else if (log.action.includes('Notification')) { iconClass = 'fas fa-bell'; iconBgClass = 'bg-orange-50'; iconTextColorClass = 'text-orange-600'; }
                    else if (log.action.includes('Added Teacher')) { iconClass = 'fas fa-chalkboard-teacher'; iconBgClass = 'bg-green-50'; iconTextColorClass = 'text-green-600'; }
                    else if (log.action.includes('Added User')) { iconClass = 'fas fa-user-plus'; iconBgClass = 'bg-red-50'; iconTextColorClass = 'text-red-600'; }
                    else if (log.action.includes('Published Announcement')) { iconClass = 'fas fa-bullhorn'; iconBgClass = 'bg-pink-50'; iconTextColorClass = 'text-pink-600'; }
                    else if (log.action.includes('Marked Attendance') || log.action.includes('Updated Attendance')) { iconClass = 'fas fa-check-circle'; iconBgClass = 'bg-indigo-50'; iconTextColorClass = 'text-indigo-600'; }


                    div.innerHTML = `
                        <div class="icon-wrapper ${iconBgClass} ${iconTextColorClass}">
                            <i class="${iconClass}"></i>
                        </div>
                        <div>
                            <p class="font-medium">${log.action}</p>
                            <p class="text-sm text-gray-500">${log.details}</p>
                            <p class="text-xs text-gray-400">${log.timestamp}</p>
                        </div>
                    `;
                    recentActivityList.appendChild(div);
                });
            }

            // Reports Module Charts
            function renderReportsCharts() {
                const attendanceCtx = document.getElementById('attendanceChart');
                const performanceCtx = document.getElementById('performanceChart');

                if (attendanceCtx && !attendanceChartInstance) {
                    attendanceChartInstance = new Chart(attendanceCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Average Attendance (%)',
                                data: [95, 92, 96, 90, 93, 97],
                                backgroundColor: 'rgba(79, 70, 229, 0.8)', // Primary color
                                borderColor: 'rgba(79, 70, 229, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                } else if (attendanceChartInstance) {
                    attendanceChartInstance.update();
                }

                if (performanceCtx && !performanceChartInstance) {
                    performanceChartInstance = new Chart(performanceCtx, {
                        type: 'line',
                        data: {
                            labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                            datasets: [{
                                label: 'Average Exam Score',
                                data: [78, 82, 80, 85],
                                fill: false,
                                borderColor: 'rgba(16, 185, 129, 1)', // Secondary color
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                } else if (performanceChartInstance) {
                    performanceChartInstance.update();
                }
            }


            // Modals for Add/Edit Student, Teacher, User, Announcement, Attendance
            window.showAddStudentForm = function() {
                studentModalTitle.textContent = 'Add New Student';
                studentFormSubmitBtn.textContent = 'Add Student';
                document.getElementById('studentId').value = '';
                studentForm.reset();
                if (studentModal) studentModal.classList.remove('hidden');
            }
            window.editStudent = function(id) {
                const student = students.find(s => s.id === id);
                if (student) {
                    studentModalTitle.textContent = 'Edit Student';
                    studentFormSubmitBtn.textContent = 'Save Changes';
                    document.getElementById('studentId').value = student.id;
                    document.getElementById('studentFullName').value = student.name;
                    document.getElementById('studentFatherName').value = student.fatherName;
                    document.getElementById('studentMotherName').value = student.motherName;
                    document.getElementById('studentClass').value = student.class;
                    document.getElementById('studentRollNo').value = student.rollNo;
                    document.getElementById('studentAadharNo').value = student.aadharNo;
                    document.getElementById('studentEmail').value = student.email;
                    document.getElementById('studentPhone').value = student.phone;
                    document.getElementById('studentStatus').value = student.status;
                    if (studentModal) studentModal.classList.remove('hidden');
                }
            }
            window.deleteStudent = function(id) {
                if (confirm('Are you sure you want to delete this student?')) {
                    const studentIndex = students.findIndex(s => s.id === id);
                    if (studentIndex > -1) {
                        const deletedStudent = students.splice(studentIndex, 1)[0];
                        saveDataToLocalStorage();
                        renderStudentTable();
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Deleted Student', 'Students', `Deleted student: ${deletedStudent.name} (ID: ${deletedStudent.id})`);
                        alert('Student deleted successfully!');
                    }
                }
            }

            window.showAddTeacherForm = function() {
                teacherModalTitle.textContent = 'Add New Teacher';
                teacherFormSubmitBtn.textContent = 'Add Teacher';
                document.getElementById('teacherId').value = '';
                teacherForm.reset();
                if (teacherModal) teacherModal.classList.remove('hidden');
            }
            window.editTeacher = function(id) {
                const teacher = teachers.find(t => t.id === id);
                if (teacher) {
                    teacherModalTitle.textContent = 'Edit Teacher';
                    teacherFormSubmitBtn.textContent = 'Save Changes';
                    document.getElementById('teacherId').value = teacher.id;
                    document.getElementById('teacherFullName').value = teacher.name;
                    document.getElementById('teacherSubject').value = teacher.subject;
                    document.getElementById('teacherEmail').value = teacher.email;
                    document.getElementById('teacherClasses').value = teacher.classes;
                    if (teacherModal) teacherModal.classList.remove('hidden');
                }
            }
            window.deleteTeacher = function(id) {
                if (confirm('Are you sure you want to delete this teacher?')) {
                    const teacherIndex = teachers.findIndex(t => t.id === id);
                    if (teacherIndex > -1) {
                        const deletedTeacher = teachers.splice(teacherIndex, 1)[0];
                        saveDataToLocalStorage();
                        renderTeacherTable();
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Deleted Teacher', 'Teachers', `Deleted teacher: ${deletedTeacher.name} (ID: ${deletedTeacher.id})`);
                        alert('Teacher deleted successfully!');
                    }
                }
            }

            window.showAddUserForm = function() {
                userModalTitle.textContent = 'Add New User';
                userFormSubmitBtn.textContent = 'Add User';
                document.getElementById('userId').value = '';
                userForm.reset();
                document.getElementById('userPassword').required = true; // Password is required for new user
                if (userModal) userModal.classList.remove('hidden');
            }
            window.editUser = function(id) {
                const user = users.find(u => u.id === id);
                if (user) {
                    userModalTitle.textContent = 'Edit User';
                    userFormSubmitBtn.textContent = 'Save Changes';
                    document.getElementById('userId').value = user.id;
                    document.getElementById('userFullName').value = user.name;
                    document.getElementById('userEmail').value = user.email;
                    document.getElementById('userRole').value = user.role;
                    document.getElementById('userStatus').value = user.status;
                    document.getElementById('userPassword').value = ''; // Clear password field for security
                    document.getElementById('userPassword').required = false; // Password not required for edit
                    if (userModal) userModal.classList.remove('hidden');
                }
            }
            window.deleteUser = function(id) {
                if (confirm('Are you sure you want to delete this user?')) {
                    const userIndex = users.findIndex(u => u.id === id);
                    if (userIndex > -1) {
                        const deletedUser = users.splice(userIndex, 1)[0];
                        saveDataToLocalStorage();
                        renderUserTable();
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Deleted User', 'User Management', `Deleted user: ${deletedUser.name} (ID: ${deletedUser.id})`);
                        alert('User deleted successfully!');
                    }
                }
            }

            window.showAddAnnouncementModal = function() {
                announcementModalTitle.textContent = 'Add New Announcement';
                announcementFormSubmitBtn.textContent = 'Publish Announcement';
                document.getElementById('announcementId').value = '';
                announcementForm.reset();
                if (announcementModal) announcementModal.classList.remove('hidden');
            }
            window.editAnnouncement = function(id) {
                const announcement = announcements.find(a => a.id === id);
                if (announcement) {
                    announcementModalTitle.textContent = 'Edit Announcement';
                    announcementFormSubmitBtn.textContent = 'Save Changes';
                    document.getElementById('announcementId').value = announcement.id;
                    document.getElementById('announcementTitle').value = announcement.title;
                    document.getElementById('announcementContent').value = announcement.content;
                    document.getElementById('announcementStatus').value = announcement.status;
                    if (announcementModal) announcementModal.classList.remove('hidden');
                }
            }
            window.deleteAnnouncement = function(id) {
                if (confirm('Are you sure you want to delete this announcement?')) {
                    const announcementIndex = announcements.findIndex(a => a.id === id);
                    if (announcementIndex > -1) {
                        const deletedAnnouncement = announcements.splice(announcementIndex, 1)[0];
                        saveDataToLocalStorage();
                        renderAnnouncementTable();
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Deleted Announcement', 'Announcements', `Deleted: "${deletedAnnouncement.title}" (ID: ${deletedAnnouncement.id})`);
                        alert('Announcement deleted successfully!');
                    }
                }
            }

            // New: Student Attendance Module Modals and Functions
            window.showAddAttendanceModal = function() {
                attendanceModalTitle.textContent = 'Mark Attendance';
                attendanceFormSubmitBtn.textContent = 'Mark Attendance';
                document.getElementById('attendanceId').value = '';
                attendanceForm.reset();
                populateStudentSelect();
                document.getElementById('attendanceDate').valueAsDate = new Date(); // Set default date to today
                if (attendanceModal) attendanceModal.classList.remove('hidden');
            }

            window.editAttendance = function(id) {
                const record = attendanceRecords.find(r => r.id === id);
                if (record) {
                    attendanceModalTitle.textContent = 'Edit Attendance';
                    attendanceFormSubmitBtn.textContent = 'Save Changes';
                    document.getElementById('attendanceId').value = record.id;
                    populateStudentSelect(record.studentId); // Select the student
                    document.getElementById('attendanceDate').value = record.date;
                    document.getElementById('attendanceStatus').value = record.status;
                    document.getElementById('attendanceRemarks').value = record.remarks;
                    if (attendanceModal) attendanceModal.classList.remove('hidden');
                }
            }

            window.deleteAttendance = function(id) {
                if (confirm('Are you sure you want to delete this attendance record?')) {
                    const recordIndex = attendanceRecords.findIndex(r => r.id === id);
                    if (recordIndex > -1) {
                        const deletedRecord = attendanceRecords.splice(recordIndex, 1)[0];
                        const student = students.find(s => s.id === deletedRecord.studentId);
                        saveDataToLocalStorage();
                        renderAttendanceTable();
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Deleted Attendance', 'Attendance', `Deleted attendance for ${student ? student.name : 'Unknown Student'} on ${deletedRecord.date}`);
                        alert('Attendance record deleted successfully!');
                    }
                }
            }

            function populateStudentSelect(selectedStudentId = '') {
                if (!attendanceStudentSelect) return;
                attendanceStudentSelect.innerHTML = '<option value="">Select Student</option>';
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (Roll No: ${student.rollNo}, Class: ${student.class})`;
                    if (student.id === selectedStudentId) {
                        option.selected = true;
                    }
                    attendanceStudentSelect.appendChild(option);
                });
            }


            if (closeStudentModal) closeStudentModal.addEventListener('click', function() { if (studentModal) studentModal.classList.add('hidden'); studentForm.reset(); });
            if (closeTeacherModal) closeTeacherModal.addEventListener('click', function() { if (teacherModal) teacherModal.classList.add('hidden'); teacherForm.reset(); });
            if (closeUserModal) closeUserModal.addEventListener('click', function() { if (userModal) userModal.classList.add('hidden'); userForm.reset(); });
            if (closeAnnouncementModal) closeAnnouncementModal.addEventListener('click', function() { if (announcementModal) announcementModal.classList.add('hidden'); announcementForm.reset(); });
            if (closeAttendanceModal) closeAttendanceModal.addEventListener('click', function() { if (attendanceModal) attendanceModal.classList.add('hidden'); attendanceForm.reset(); }); // New: Close student attendance modal
            if (closeTeacherAttendanceModal) closeTeacherAttendanceModal.addEventListener('click', function() { if (teacherAttendanceModal) teacherAttendanceModal.classList.add('hidden'); teacherAttendanceForm.reset(); }); // New: Close teacher attendance modal

            // Close modals when clicking outside
            if (studentModal) studentModal.addEventListener('click', (e) => { if (e.target === studentModal) { studentModal.classList.add('hidden'); studentForm.reset(); } });
            if (teacherModal) teacherModal.addEventListener('click', (e) => { if (e.target === teacherModal) { teacherModal.classList.add('hidden'); teacherForm.reset(); } });
            if (userModal) userModal.addEventListener('click', (e) => { if (e.target === userModal) { userModal.classList.add('hidden'); userForm.reset(); } });
            if (announcementModal) announcementModal.addEventListener('click', (e) => { if (e.target === announcementModal) { announcementModal.classList.add('hidden'); announcementForm.reset(); } });
            if (attendanceModal) attendanceModal.addEventListener('click', (e) => { if (e.target === attendanceModal) { attendanceModal.classList.add('hidden'); attendanceForm.reset(); } }); // New: Close student attendance modal on outside click
            if (teacherAttendanceModal) teacherAttendanceModal.addEventListener('click', (e) => { if (e.target === teacherAttendanceModal) { teacherAttendanceModal.classList.add('hidden'); teacherAttendanceForm.reset(); } }); // New: Close teacher attendance modal on outside click


            // Add/Edit Student Form Submission
            if (studentForm) {
                studentForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const form = e.target;
                    const id = document.getElementById('studentId').value;
                    const fullName = document.getElementById('studentFullName').value;
                    const fatherName = document.getElementById('studentFatherName').value;
                    const motherName = document.getElementById('studentMotherName').value;
                    const studentClass = document.getElementById('studentClass').value;
                    const rollNo = document.getElementById('studentRollNo').value;
                    const aadharNo = document.getElementById('studentAadharNo').value;
                    const email = document.getElementById('studentEmail').value;
                    const phone = document.getElementById('studentPhone').value;
                    const status = document.getElementById('studentStatus').value;

                    if (id) {
                        // Edit existing student
                        const studentIndex = students.findIndex(s => s.id === id);
                        if (studentIndex > -1) {
                            students[studentIndex] = { ...students[studentIndex], name: fullName, fatherName, motherName, class: studentClass, rollNo, aadharNo, email, phone, status };
                            alert('Student updated successfully!');
                            addAuditLog(JSON.parse(null)?.name || 'Admin', 'Updated Student', 'Students', `Updated student: ${fullName} (ID: ${id})`);
                        }
                    } else {
                        // Add new student
                        const newStudent = {
                            id: generateUniqueId('S'),
                            name: fullName,
                            fatherName: fatherName,
                            motherName: motherName,
                            class: studentClass,
                            rollNo: rollNo,
                            aadharNo: aadharNo,
                            email: email,
                            phone: phone,
                            status: status,
                            fingerprintCredential: null // Initialize fingerprint credential
                        };
                        students.push(newStudent);
                        alert('Student added successfully!');
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Added Student', 'Students', `Added new student: ${fullName} (ID: ${newStudent.id})`);
                    }
                    
                    saveDataToLocalStorage();
                    renderStudentTable();
                    if (studentModal) studentModal.classList.add('hidden');
                    form.reset();
                });
            }

            // Add/Edit Teacher Form Submission
            if (teacherForm) {
                teacherForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const form = e.target;
                    const id = document.getElementById('teacherId').value;
                    const fullName = document.getElementById('teacherFullName').value;
                    const subject = document.getElementById('teacherSubject').value;
                    const email = document.getElementById('teacherEmail').value;
                    const classes = document.getElementById('teacherClasses').value;

                    if (id) {
                        // Edit existing teacher
                        const teacherIndex = teachers.findIndex(t => t.id === id);
                        if (teacherIndex > -1) {
                            teachers[teacherIndex] = { ...teachers[teacherIndex], name: fullName, subject, email, classes };
                            alert('Teacher updated successfully!');
                            addAuditLog(JSON.parse(null)?.name || 'Admin', 'Updated Teacher', 'Teachers', `Updated teacher: ${fullName} (ID: ${id})`);
                        }
                    } else {
                        // Add new teacher
                        const newTeacher = {
                            id: generateUniqueId('T'),
                            name: fullName,
                            subject: subject,
                            email: email,
                            classes: classes,
                            fingerprintCredential: null // Initialize fingerprint credential
                        };
                        teachers.push(newTeacher);
                        alert('Teacher added successfully!');
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Added Teacher', 'Teachers', `Added new teacher: ${fullName} (ID: ${newTeacher.id})`);
                    }
                    
                    saveDataToLocalStorage();
                    renderTeacherTable();
                    if (teacherModal) teacherModal.classList.add('hidden');
                    form.reset();
                });
            }

            // Add/Edit User Form Submission
            if (userForm) {
                userForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const form = e.target;
                    const id = document.getElementById('userId').value;
                    const fullName = document.getElementById('userFullName').value;
                    const email = document.getElementById('userEmail').value;
                    const role = document.getElementById('userRole').value;
                    const password = document.getElementById('userPassword').value;
                    const status = document.getElementById('userStatus').value;

                    if (id) {
                        // Edit existing user
                        const userIndex = users.findIndex(u => u.id === id);
                        if (userIndex > -1) {
                            users[userIndex] = { ...users[userIndex], name: fullName, email, role, status };
                            if (password) { // Only update password if provided
                                users[userIndex].password = password; // In a real app, this would be hashed
                            }
                            alert('User updated successfully!');
                            addAuditLog(JSON.parse(null)?.name || 'Admin', 'Updated User', 'User Management', `Updated user: ${fullName} (ID: ${id})`);
                        }
                    } else {
                        // Add new user
                        if (!password) {
                            alert('Password is required for new users.');
                            return;
                        }
                        const newUser = {
                            id: generateUniqueId('U'),
                            name: fullName,
                            email: email,
                            role: role,
                            password: password, // In a real app, this would be hashed
                            status: status
                        };
                        users.push(newUser);
                        alert('User added successfully!');
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Added User', 'User Management', `Added new user: ${fullName} (Role: ${role})`);
                    }
                    
                    saveDataToLocalStorage();
                    renderUserTable();
                    if (userModal) userModal.classList.add('hidden');
                    form.reset();
                });
            }

            // Add/Edit Announcement Form Submission
            if (announcementForm) {
                announcementForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const form = e.target;
                    const id = document.getElementById('announcementId').value;
                    const title = document.getElementById('announcementTitle').value;
                    const content = document.getElementById('announcementContent').value;
                    const status = document.getElementById('announcementStatus').value;
                    const datePosted = new Date().toISOString().split('T')[0];

                    if (id) {
                        // Edit existing announcement
                        const announcementIndex = announcements.findIndex(a => a.id === id);
                        if (announcementIndex > -1) {
                            announcements[announcementIndex] = { ...announcements[announcementIndex], title, content, status };
                            alert('Announcement updated successfully!');
                            addAuditLog(JSON.parse(null)?.name || 'Admin', 'Updated Announcement', 'Announcements', `Updated: "${title}" (ID: ${id})`);
                        }
                    } else {
                        // Add new announcement
                        const newAnnouncement = {
                            id: generateUniqueId('A'),
                            title: title,
                            content: content,
                            datePosted: datePosted,
                            status: status
                        };
                        announcements.push(newAnnouncement);
                        alert('Announcement published successfully!');
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Published Announcement', 'Announcements', `Published: "${title}"`);
                    }
                    
                    saveDataToLocalStorage();
                    renderAnnouncementTable();
                    if (announcementModal) announcementModal.classList.add('hidden');
                    form.reset();
                });
            }

            // New: Student Attendance Form Submission
            if (attendanceForm) {
                attendanceForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const form = e.target;
                    const id = document.getElementById('attendanceId').value;
                    const studentId = document.getElementById('attendanceStudentSelect').value;
                    const date = document.getElementById('attendanceDate').value;
                    const status = document.getElementById('attendanceStatus').value;
                    const remarks = document.getElementById('attendanceRemarks').value;

                    if (!studentId || !date || !status) {
                        alert('Please fill in all required fields.');
                        return;
                    }

                    const student = students.find(s => s.id === studentId);
                    if (!student) {
                        alert('Selected student not found.');
                        return;
                    }

                    if (id) {
                        // Edit existing attendance record
                        const recordIndex = attendanceRecords.findIndex(r => r.id === id);
                        if (recordIndex > -1) {
                            attendanceRecords[recordIndex] = { ...attendanceRecords[recordIndex], studentId, date, status, remarks };
                            alert('Attendance record updated successfully!');
                            addAuditLog(JSON.parse(null)?.name || 'Admin', 'Updated Attendance', 'Attendance', `Updated attendance for ${student.name} on ${date} to ${status}`);
                        }
                    } else {
                        // Add new attendance record
                        const newRecord = {
                            id: generateUniqueId('ATT'),
                            studentId: studentId,
                            date: date,
                            status: status,
                            remarks: remarks
                        };
                        attendanceRecords.push(newRecord);
                        alert('Attendance marked successfully!');
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Marked Attendance', 'Attendance', `Marked ${status} for ${student.name} on ${date}`);
                    }
                    
                    saveDataToLocalStorage();
                    renderAttendanceTable();
                    if (attendanceModal) attendanceModal.classList.add('hidden');
                    form.reset();
                });
            }

            // New: Teacher Attendance Form Submission
            if (teacherAttendanceForm) {
                teacherAttendanceForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const form = e.target;
                    const id = document.getElementById('teacherAttendanceId').value;
                    const teacherId = document.getElementById('teacherAttendanceTeacherSelect').value;
                    const date = document.getElementById('teacherAttendanceDate').value;
                    const status = document.getElementById('teacherAttendanceStatus').value;
                    const remarks = document.getElementById('teacherAttendanceRemarks').value;

                    if (!teacherId || !date || !status) {
                        alert('Please fill in all required fields.');
                        return;
                    }

                    const teacher = teachers.find(t => t.id === teacherId);
                    if (!teacher) {
                        alert('Selected teacher not found.');
                        return;
                    }

                    if (id) {
                        // Edit existing teacher attendance record
                        const recordIndex = teacherAttendanceRecords.findIndex(r => r.id === id);
                        if (recordIndex > -1) {
                            teacherAttendanceRecords[recordIndex] = { ...teacherAttendanceRecords[recordIndex], teacherId, date, status, remarks };
                            alert('Teacher attendance record updated successfully!');
                            addAuditLog(JSON.parse(null)?.name || 'Admin', 'Updated Teacher Attendance', 'Teacher Attendance', `Updated attendance for ${teacher.name} on ${date} to ${status}`);
                        }
                    } else {
                        // Add new teacher attendance record
                        const newRecord = {
                            id: generateUniqueId('TATT'),
                            teacherId: teacherId,
                            date: date,
                            status: status,
                            remarks: remarks
                        };
                        teacherAttendanceRecords.push(newRecord);
                        alert('Teacher attendance marked successfully!');
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Marked Teacher Attendance', 'Teacher Attendance', `Marked ${status} for ${teacher.name} on ${date}`);
                    }
                    
                    saveDataToLocalStorage();
                    renderTeacherAttendanceTable();
                    if (teacherAttendanceModal) teacherAttendanceModal.classList.add('hidden');
                    form.reset();
                });
            }

            // --- WebAuthn Integration ---

            // Utility function to convert ArrayBuffer to Base64 string
            function arrayBufferToBase64(buffer) {
                return btoa(String.fromCharCode.apply(null, new Uint8Array(buffer)));
            }

            // Utility function to convert Base64 string to ArrayBuffer
            function base64ToArrayBuffer(base64) {
                const binary_string = atob(base64);
                const len = binary_string.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binary_string.charCodeAt(i);
                }
                return bytes.buffer;
            }

            // Student Fingerprint Registration
            if (registerStudentFingerprintBtn) {
                registerStudentFingerprintBtn.addEventListener('click', async () => {
                    const studentId = attendanceStudentSelect.value;
                    if (!studentId) {
                        alert('Please select a student first.');
                        return;
                    }
                    const student = students.find(s => s.id === studentId);
                    if (!student) {
                        alert('Selected student not found.');
                        return;
                    }

                    try {
                        const challenge = new Uint8Array(16);
                        window.crypto.getRandomValues(challenge);

                        const credential = await navigator.credentials.create({
                            publicKey: {
                                rp: {
                                    name: "Tapowan Public School"
                                },
                                user: {
                                    id: new TextEncoder().encode(student.id),
                                    name: student.email || student.id,
                                    displayName: student.name
                                },
                                challenge: challenge,
                                pubKeyCredParams: [{
                                    type: "public-key",
                                    alg: -7 // ES256
                                }, {
                                    type: "public-key",
                                    alg: -257 // RS256
                                }],
                                authenticatorSelection: {
                                    authenticatorAttachment: "platform", // Use platform authenticator (e.g., fingerprint scanner)
                                    userVerification: "required", // Require fingerprint or other biometric
                                    residentKey: "required" // Make it discoverable
                                },
                                timeout: 60000, // 60 seconds
                                attestation: "direct"
                            }
                        });

                        // Store the credential details
                        student.fingerprintCredential = {
                            id: arrayBufferToBase64(credential.rawId),
                            publicKey: arrayBufferToBase64(credential.response.getPublicKey()),
                            authenticatorData: arrayBufferToBase64(credential.response.authenticatorData),
                            clientDataJSON: arrayBufferToBase64(credential.response.clientDataJSON)
                        };
                        saveDataToLocalStorage();
                        alert(`Fingerprint registered successfully for ${student.name}!`);
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Registered Fingerprint', 'Attendance', `Registered fingerprint for student: ${student.name} (ID: ${student.id})`);

                    } catch (error) {
                        console.error("Fingerprint registration failed:", error);
                        alert(`Fingerprint registration failed: ${error.message || error}`);
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Fingerprint Registration Failed', 'Attendance', `Failed to register fingerprint for student: ${student.name} - ${error.message}`);
                    }
                });
            }

            // Student Fingerprint Verification
            if (verifyStudentFingerprintBtn) {
                verifyStudentFingerprintBtn.addEventListener('click', async () => {
                    const studentId = attendanceStudentSelect.value;
                    if (!studentId) {
                        alert('Please select a student first.');
                        return;
                    }
                    const student = students.find(s => s.id === studentId);
                    if (!student) {
                        alert('Selected student not found.');
                        return;
                    }
                    if (!student.fingerprintCredential) {
                        alert('No fingerprint registered for this student. Please register one first.');
                        return;
                    }

                    try {
                        const challenge = new Uint8Array(16);
                        window.crypto.getRandomValues(challenge);

                        const credential = await navigator.credentials.get({
                            publicKey: {
                                challenge: challenge,
                                allowCredentials: [{
                                    id: base64ToArrayBuffer(student.fingerprintCredential.id),
                                    type: "public-key"
                                }],
                                userVerification: "required",
                                timeout: 60000
                            }
                        });

                        // In a real application, you would send this credential to a server for verification.
                        // For this demo, we'll assume success if the credential object is returned.
                        // A more robust verification would involve checking signature, challenge, etc.

                        alert(`Fingerprint verified successfully for ${student.name}! Attendance marked as Present.`);
                        document.getElementById('attendanceStatus').value = 'Present';
                        document.getElementById('attendanceFormSubmitBtn').click(); // Submit the form
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Verified Fingerprint', 'Attendance', `Verified fingerprint for student: ${student.name} (ID: ${student.id}) - Marked Present`);

                    } catch (error) {
                        console.error("Fingerprint verification failed:", error);
                        alert(`Fingerprint verification failed: ${error.message || error}`);
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Fingerprint Verification Failed', 'Attendance', `Failed to verify fingerprint for student: ${student.name} - ${error.message}`);
                    }
                });
            }

            // Teacher Fingerprint Verification
            if (verifyTeacherFingerprintBtn) {
                verifyTeacherFingerprintBtn.addEventListener('click', async () => {
                    const teacherId = teacherAttendanceTeacherSelect.value;
                    if (!teacherId) {
                        alert('Please select a teacher first.');
                        return;
                    }
                    const teacher = teachers.find(t => t.id === teacherId);
                    if (!teacher) {
                        alert('Selected teacher not found.');
                        return;
                    }
                    if (!teacher.fingerprintCredential) {
                        alert('No fingerprint registered for this teacher. Please register one first.');
                        return;
                    }

                    try {
                        const challenge = new Uint8Array(16);
                        window.crypto.getRandomValues(challenge);

                        const credential = await navigator.credentials.get({
                            publicKey: {
                                challenge: challenge,
                                allowCredentials: [{
                                    id: base64ToArrayBuffer(teacher.fingerprintCredential.id),
                                    type: "public-key"
                                }],
                                userVerification: "required",
                                timeout: 60000
                            }
                        });

                        // In a real application, you would send this credential to a server for verification.
                        // For this demo, we'll assume success if the credential object is returned.
                        // A more robust verification would involve checking signature, challenge, etc.

                        alert(`Fingerprint verified successfully for ${teacher.name}! Attendance marked as Present.`);
                        document.getElementById('teacherAttendanceStatus').value = 'Present';
                        document.getElementById('teacherAttendanceFormSubmitBtn').click(); // Submit the form
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Verified Fingerprint', 'Teacher Attendance', `Verified fingerprint for teacher: ${teacher.name} (ID: ${teacher.id}) - Marked Present`);

                    } catch (error) {
                        console.error("Fingerprint verification failed:", error);
                        alert(`Fingerprint verification failed: ${error.message || error}`);
                        addAuditLog(JSON.parse(null)?.name || 'Admin', 'Fingerprint Verification Failed', 'Teacher Attendance', `Failed to verify fingerprint for teacher: ${teacher.name} - ${error.message}`);
                    }
                });
            }

            // NEW: Dark Mode Toggle Logic
            // Function to apply/remove dark mode
            function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                const isDarkMode = document.body.classList.contains('dark-mode');
                 // Save preference
                darkModeIcon.className = isDarkMode ? 'fas fa-sun text-gray-600' : 'fas fa-moon text-gray-600'; // Change icon
            }

            // Check for saved preference on load
            if (null === 'true') {
                toggleDarkMode(); // Apply dark mode if saved
            } else {
                // Ensure the moon icon is set if not in dark mode initially
                darkModeIcon.className = 'fas fa-moon text-gray-600';
            }

            // Event listener for the toggle button
            darkModeToggle.addEventListener('click', toggleDarkMode);


            // Initial render of all tables when the page loads (if logged in)
            if (null === 'true') {
                renderAllTables();
                updateDashboardStats();
                renderRecentActivity();
                updateProfileForm();
                updateLoggedInUserName();
                renderReportsCharts();
            }
        });
    </script>
<!-- Other existing scripts -->
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
<script>
  var typed = new Typed('#typed-welcome', {
    strings: ["Welcome, Admin!", "Welcome, Teacher!", "Welcome, Student!"],
    typeSpeed: 40,
    backSpeed: 20,
    loop: true
  });
</script>
<script>
  document.getElementById('darkModeToggle').addEventListener('click', function () {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
  });
  window.addEventListener('load', () => {
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
    }
  });
</script>
<script>
function animateCounter(id, target) {
  let el = document.getElementById(id);
  let count = 0;
  let interval = setInterval(() => {
    if (count >= target) clearInterval(interval);
    else el.textContent = ++count;
  }, 30);
}
window.onload = () => {
  animateCounter('totalStudentsCount', 1250);
  animateCounter('totalTeachersCount', 45);
  animateCounter('monthlyRevenue', 34500);
  animateCounter('upcomingEventsCount', 6);
};
</script>
<script>
function startVoiceAssistant() {
  const recognition = new webkitSpeechRecognition();
  recognition.lang = "en-US";
  recognition.onresult = (event) => {
    const command = event.results[0][0].transcript.toLowerCase();
    alert("You said: " + command);
  };
  recognition.start();
}
</script>
<!-- âœ… Supabase Auth Configuration -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabase = supabase.createClient(
    'https://wizyuwbezyltaxatkupc.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indpenl1d2JlenlsdGF4YXRrdXBjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMDc1MzgsImV4cCI6MjA2ODY4MzUzOH0.akCyzqHG4LIhboUBy36djCKHjRVDfb5KoTPNiIY3AtA'
  );

  // âœ… Define login handler FIRST
  async function handleLogin(email, password) {
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) {
      alert('âŒ Login failed: ' + error.message);
    } else {
      alert('âœ… Login successful');
      console.log(data);
      // Optional: window.location.href = "/dashboard.html";
    }
  }

  // âœ… Wait for DOM before binding form
  document.addEventListener("DOMContentLoaded", () => {
    const loginForm = document.getElementById("loginForm");
    const emailInput = document.getElementById("username");
    const passwordInput = document.getElementById("password");

    if (loginForm && emailInput && passwordInput) {
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const username = emailInput.value.trim();
        const email = username.includes("@") ? username : `${username}@example.com`;
        const password = passwordInput.value.trim();

        await handleLogin(email, password); // âœ… Call after function defined
      });
    }
  });

  // âœ… Optional: check session status
  supabase.auth.getSession().then(({ data: { session } }) => {
    if (session) {
      console.log('âœ… Session found:', session);
    } else {
      console.log('âŒ No session found.');
    }
  });
</script>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabase = createClient('https://wizyuwbezyltaxatkupc.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indpenl1d2JlenlsdGF4YXRrdXBjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMDc1MzgsImV4cCI6MjA2ODY4MzUzOH0.akCyzqHG4LIhboUBy36djCKHjRVDfb5KoTPNiIY3AtA');

document.getElementById("loginForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const { data, error } = await supabase.auth.signInWithPassword({
    email,
    password
  });

  if (error) {
    alert("Login failed: " + error.message);
  } else {
    document.getElementById("login-ui").style.display = "none";
    document.getElementById("school-site-ui").style.display = "block";
    document.getElementById("loggedInUserName").innerText = email;
  }
});
        <script type="module">
function showModule(moduleName) {
  document.querySelectorAll("#modulesContainer > div").forEach(div => {
    div.style.display = "none";
  });

  const selected = document.getElementById(moduleName + "Module");
  if (selected) {
    selected.style.display = "block";
    document.getElementById("dashboardMainContent").style.display = "none";
    document.getElementById("modulesContainer").classList.remove("hidden");
  }
}

document.querySelectorAll(".nav-item").forEach(item => {
  item.addEventListener("click", (e) => {
    e.preventDefault();
    showModule(item.dataset.module);
  });
});

document.querySelectorAll(".open-module").forEach(btn => {
  btn.addEventListener("click", () => {
    showModule(btn.dataset.module);
  });
});

document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    showModule(tab.dataset.tab);
  });
});

document.getElementById("currentModuleTitle").addEventListener("click", () => {
  document.getElementById("dashboardMainContent").style.display = "block";
  document.getElementById("modulesContainer").classList.add("hidden");
});
</script></body>
</html>
